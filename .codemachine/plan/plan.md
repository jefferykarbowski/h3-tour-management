# Project Plan: H3 Tour Management Plugin Revamp

**Version:** 1.0
**Date:** 2025-10-09
**Generated By:** Codex GPT-5

## 1. Project Overview

*   **Goal:** Restore reliability, maintainability, and usability of the H3 Tour Management WordPress plugin by resolving critical defects, aligning S3 operations with canonical metadata, and delivering a modernized admin experience.
*   **High-Level Requirements Summary:**
    *   Fix delete/archive functionality by using tour metadata as the single source of truth for S3 folder paths and add robust AWS operation logging.
    *   Repair Change URL, Rename, Update, Get Script, and Rebuild Metadata features so database state, redirects, embeds, and UI refreshes remain consistent.
    *   Introduce structured logging and repeatable test workflows that cover AWS integrations, AJAX endpoints, and UI behaviours.
    *   Refactor `H3TM_Admin` into focused traits to shrink file size, isolate responsibilities, and simplify future maintenance.
    *   Enhance the admin UI with search/filter, bulk actions, progress tracking, and confirmation dialogs without breaking existing workflows.
    *   Preserve compatibility with WordPress 5.8+/PHP 7.4+, AWS S3/CloudFront/Lambda integrations, and existing tour data.
*   **Key Assumptions:**
    *   WordPress runs on PHP 7.4+ with the ability to install additional Composer/NPM tooling if required.
    *   Administrators executing plugin actions possess the `manage_options` capability and valid WP nonces are enforced for all AJAX endpoints.
    *   AWS credentials with least-privilege access to the target S3 bucket and CloudFront distribution are already provisioned and retrievable within the plugin.
    *   Lambda maintains its current behaviour of preserving spaces in S3 folder names; WordPress adjustments must accommodate that convention.
    *   A staging environment (or the ability to spin one up) exists to verify destructive operations (delete/archive) before production rollout.

## 2. Core Architecture

*   **Architectural Style:** Layered WordPress plugin (modular monolith) augmented by AWS serverless components (S3, CloudFront, Lambda) and modularized internally via PHP traits for separation of concerns.
*   **Technology Stack:**
    *   Frontend: WordPress Admin UI with PHP templating, jQuery 3.x, WP List Table components, and custom modals.
    *   Backend: PHP 7.4+ leveraging WordPress plugin APIs, AWS SDK for PHP v3, optional Composer autoloading for traits/utilities.
    *   Database: MySQL 5.7+/8.0 accessed through the WordPress database abstraction (`$wpdb`), primary table `wp_h3tm_tour_metadata`.
    *   Messaging/Queues: AWS Lambda asynchronous processing with status persisted to S3 (`status.json`); WordPress cron optional for health checks.
    *   Deployment: Packaged WordPress plugin (ZIP) deployed to WP instance; AWS Lambda/CloudFront maintained via existing infrastructure; CloudFront invalidation triggered via AWS SDK.
    *   Other Key Libraries/Tools: PSR-3-style logging helper (file + `error_log`), PHPUnit for PHP regression tests, ESLint/Prettier (via `package.json`) for JS hygiene.
*   **Key Components/Services:** `H3TM_Admin` orchestrator with trait mixins (Component Diagram in I1.T2); `H3TM_Tour_Metadata` DAO enforcing canonical `s3_folder`; `H3TM_S3_Simple` wrapper for AWS operations and logging; `H3TM_URL_Redirector` maintaining slug history; Admin JS modules handling modal interactions and progress (sequence diagrams in I1.T5 & I2.T5); supporting assets (CSS) for UX updates.
*   **Data Model Overview:** Core entity `wp_h3tm_tour_metadata` stores `tour_slug`, `display_name`, canonical `s3_folder` (spaces preserved), and `url_history` JSON for redirects; supplementary tables rely on WordPress defaults. Detailed ERD captured in I1.T3 (docs/diagrams/metadata-erd.mmd).
*   **API Contract Style:** WordPress `admin-ajax.php` actions described via OpenAPI v3 YAML (`api/admin-ajax.yaml`, produced in I2.T4) to enable automated validation of request/response payloads; future REST endpoints can extend the same spec.
*   **Communication Patterns:** Synchronous AJAX calls from admin JS to PHP handlers for create/update/delete style operations; asynchronous polling (or long-poll) against S3 `status.json` for Lambda progress; PHP components interact via method calls outlined in component/sequence diagrams (see I1.T5 for delete flow, I2.T5 for change URL flow).

## 2.1. Key Architectural Artifacts Planned

*   Component Diagram (PlantUML) – Visualize major plugin components, trait boundaries, and AWS integrations (Created in I1.T2 -> `docs/diagrams/component-overview.puml`).
*   Metadata ERD (Mermaid) – Document `wp_h3tm_tour_metadata` schema, indexes, and relationships (Created in I1.T3 -> `docs/diagrams/metadata-erd.mmd`).
*   Delete Tour Sequence Diagram (Mermaid) – Detail request/response + S3 operations during deletion (Created in I1.T5 -> `docs/diagrams/delete-tour-sequence.mmd`).
*   Admin AJAX OpenAPI Spec (YAML) – Define contract for key admin-ajax actions including Change URL, Rename, Update, Rebuild metadata (Created in I2.T4 -> `api/admin-ajax.yaml`).
*   Change URL Sequence Diagram (Mermaid) – Show end-to-end flow including redirect updates and UI refresh (Created in I2.T5 -> `docs/diagrams/change-url-sequence.mmd`).
*   Trait Refactor ADR (Markdown) – Capture rationale and outcomes for splitting `H3TM_Admin` (Created in I3.T1 -> `docs/adr/0001-admin-traits.md`).
*   Admin UX Wireframe & Interaction Guide (Markdown + ASCII) – Specify table layout, bulk actions, progress UI (Created in I4.T1 -> `docs/ux/admin-table-wireframe.md`).

## 3. Directory Structure

*   **Root Directory:** `h3-tour-management/`
*   **Structure Definition:**
    ~~~
    h3-tour-management/
    ├── assets/
    │   ├── css/
    │   │   └── admin.css
    │   └── js/
    │       ├── admin.js
    │       └── admin-tour-features.js
    ├── includes/
    │   ├── class-h3tm-admin.php
    │   ├── class-h3tm-s3-simple.php
    │   ├── class-h3tm-tour-metadata.php
    │   ├── class-h3tm-url-redirector.php
    │   └── traits/
    │       ├── trait-h3tm-tour-handlers.php
    │       ├── trait-h3tm-delete-rename.php
    │       ├── trait-h3tm-s3-operations.php
    │       ├── trait-h3tm-migration.php
    │       └── trait-h3tm-page-renderers.php
    ├── api/
    │   └── admin-ajax.yaml            # OpenAPI spec for admin endpoints
    ├── docs/
    │   ├── requirements/
    │   │   └── critical-bugs.md      # Consolidated requirements & test notes
    │   ├── diagrams/                 # PlantUML/Mermaid sources
    │   │   ├── component-overview.puml
    │   │   ├── metadata-erd.mmd
    │   │   ├── delete-tour-sequence.mmd
    │   │   └── change-url-sequence.mmd
    │   ├── adr/
    │   │   └── 0001-admin-traits.md  # Decision record for trait refactor
    │   └── ux/
    │       └── admin-table-wireframe.md
    ├── tests/
    │   ├── phpunit.xml.dist          # PHP unit/integration harness configuration
    │   ├── php/
    │   │   └── DeleteTourTest.php    # Regression tests for delete/archive flow
    │   └── manual/
    │       └── delete-flow.md        # Manual QA checklist
    ├── .codemachine/
    │   └── plan/
    │       └── plan.md               # Current project plan (this file)
    ├── README.md
    ├── composer.json                 # Autoload & tooling configuration
    ├── package.json                  # JS tooling (lint/build/test scripts)
    └── h3-tour-management.php
    ~~~
    This structure retains the existing plugin layout while adding dedicated spaces for architectural artifacts, specifications, and automated/manual tests, ensuring future agents can quickly locate both code and documentation.

## 4. Iteration Plan

*   **Total Iterations Planned:** 4
*   **Iteration Dependencies:** `I2` depends on `I1`; `I3` depends on `I2`; `I4` depends on `I3`. Within each iteration, task-level dependencies further constrain execution order.

---

### Iteration 1: Stabilize Metadata Contracts & Delete Flow

*   **Iteration ID:** `I1`
*   **Goal:** Capture authoritative requirements, align documentation, and repair the delete/archive flow by enforcing metadata-driven S3 access with proper logging.
*   **Prerequisites:** None
*   **Tasks:**
    *   **Task 1.1:**
        *   **Task ID:** `I1.T1`
        *   **Description:** Compile the provided specifications into a concise Markdown brief covering critical bugs, root causes, target behaviours, and manual test checklists.
        *   **Agent Type Hint:** `DocumentationAgent`
        *   **Inputs:** Section 1; user requirements summary from prompt.
        *   **Input Files:** []
        *   **Target Files:** ["docs/requirements/critical-bugs.md"]
        *   **Deliverables:** Markdown brief describing each critical bug, expected fixes, and reproducible test steps.
        *   **Acceptance Criteria:** Document lists all five critical bugs with reproduction + validation steps; includes logging expectations; stored at the specified path with valid Markdown headings.
        *   **Dependencies:** []
        *   **Parallelizable:** No
    *   **Task 1.2:**
        *   **Task ID:** `I1.T2`
        *   **Description:** Produce a PlantUML component diagram reflecting current and target plugin components, emphasizing metadata, S3 operations, and admin traits.
        *   **Agent Type Hint:** `DiagrammingAgent`
        *   **Inputs:** Section 2; output of `I1.T1`.
        *   **Input Files:** ["docs/requirements/critical-bugs.md"]
        *   **Target Files:** ["docs/diagrams/component-overview.puml"]
        *   **Deliverables:** PlantUML file rendering without errors, showing component interactions and external systems.
        *   **Acceptance Criteria:** Diagram aligns with Section 2 descriptions; PlantUML syntax passes validation; references upcoming traits and AWS services.
        *   **Dependencies:** [I1.T1]
        *   **Parallelizable:** No
    *   **Task 1.3:**
        *   **Task ID:** `I1.T3`
        *   **Description:** Create a Mermaid ERD documenting `wp_h3tm_tour_metadata`, highlighting canonical `s3_folder` usage and indexes for slug lookups.
        *   **Agent Type Hint:** `DiagrammingAgent`
        *   **Inputs:** Section 2; `docs/requirements/critical-bugs.md`.
        *   **Input Files:** ["docs/requirements/critical-bugs.md"]
        *   **Target Files:** ["docs/diagrams/metadata-erd.mmd"]
        *   **Deliverables:** Mermaid ERD file detailing fields, constraints, and notes on slug history.
        *   **Acceptance Criteria:** ERD reflects schema from requirements; Mermaid preview renders successfully; notes clarify `s3_folder` as canonical path.
        *   **Dependencies:** [I1.T1]
        *   **Parallelizable:** No
    *   **Task 1.4:**
        *   **Task ID:** `I1.T4`
        *   **Description:** Refactor delete/archive logic to pull `s3_folder` from metadata, add structured logging, and extend regression notes for delete scenarios.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Sections 2 & 3; outputs of `I1.T1`–`I1.T3`.
        *   **Input Files:** ["includes/class-h3tm-s3-simple.php","includes/class-h3tm-tour-metadata.php","docs/requirements/critical-bugs.md"]
        *   **Target Files:** ["includes/class-h3tm-s3-simple.php","includes/class-h3tm-tour-metadata.php","docs/requirements/critical-bugs.md"]
        *   **Deliverables:** Updated PHP logic using metadata-derived S3 folders, added logging statements, and appended test instructions.
        *   **Acceptance Criteria:** `archive_tour()` exclusively uses metadata `s3_folder`; logging captures success/failure with tour identifiers; `php -l` passes for touched files; manual test notes updated to include edge cases (spaces, hyphens, special chars).
        *   **Dependencies:** [I1.T1]
        *   **Parallelizable:** No
    *   **Task 1.5:**
        *   **Task ID:** `I1.T5`
        *   **Description:** Document the delete workflow via a Mermaid sequence diagram covering UI trigger, PHP handler, metadata lookup, and S3 operations.
        *   **Agent Type Hint:** `DiagrammingAgent`
        *   **Inputs:** Section 2; outputs of `I1.T2`–`I1.T4`.
        *   **Input Files:** ["docs/diagrams/component-overview.puml","docs/requirements/critical-bugs.md"]
        *   **Target Files:** ["docs/diagrams/delete-tour-sequence.mmd"]
        *   **Deliverables:** Mermaid sequence diagram illustrating interactions and error branches.
        *   **Acceptance Criteria:** Diagram matches implemented logic post-`I1.T4`; Mermaid syntax validates; includes logging touchpoints.
        *   **Dependencies:** [I1.T2, I1.T4]
        *   **Parallelizable:** No

---

### Iteration 2: Repair Admin Actions & Front-End Synchronization

*   **Iteration ID:** `I2`
*   **Goal:** Restore all admin actions (Change URL, Rename, Update, Get Script, Rebuild Metadata), ensure database/redirect consistency, and capture formal API contracts.
*   **Prerequisites:** `I1`
*   **Tasks:**
    *   **Task 2.1:**
        *   **Task ID:** `I2.T1`
        *   **Description:** Audit and fix PHP handlers for Change URL, Rename, Update, Get Script, and Rebuild Metadata to ensure action registration, nonce/capability checks, metadata usage, and redirect updates.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Sections 2 & 3; outputs of `I1.T1`.
        *   **Input Files:** ["includes/class-h3tm-admin.php","includes/class-h3tm-tour-metadata.php","includes/class-h3tm-url-redirector.php","docs/requirements/critical-bugs.md"]
        *   **Target Files:** ["includes/class-h3tm-admin.php","includes/class-h3tm-tour-metadata.php","includes/class-h3tm-url-redirector.php","docs/requirements/critical-bugs.md"]
        *   **Deliverables:** Updated PHP handlers with proper hooks, logging, slug history updates, and refreshed manual test notes.
        *   **Acceptance Criteria:** All relevant `add_action` calls are registered; slug change updates DB and redirect history; rebuild metadata handler responds with success JSON; `php -l` clean; manual tests describe UI refresh expectations.
        *   **Dependencies:** [I1.T4]
        *   **Parallelizable:** No
    *   **Task 2.2:**
        *   **Task ID:** `I2.T2`
        *   **Description:** Produce an OpenAPI v3 spec capturing request/response schemas for key admin AJAX actions, including error formats and nonce requirements.
        *   **Agent Type Hint:** `DocumentationAgent`
        *   **Inputs:** Section 2; outputs of `I2.T1`.
        *   **Input Files:** ["includes/class-h3tm-admin.php","docs/requirements/critical-bugs.md"]
        *   **Target Files:** ["api/admin-ajax.yaml"]
        *   **Deliverables:** Valid OpenAPI YAML documenting endpoints, parameters, responses, and security schemes.
        *   **Acceptance Criteria:** Spec passes OpenAPI validator; includes operations for delete, change URL, rename, update, get script, rebuild metadata; references nonce header/query usage.
        *   **Dependencies:** [I2.T1]
        *   **Parallelizable:** No
    *   **Task 2.3:**
        *   **Task ID:** `I2.T3`
        *   **Description:** Refactor admin JavaScript to resolve hoisting issues, ensure delegated event binding for dynamic elements, and add diagnostic logging hooks.
        *   **Agent Type Hint:** `FrontendAgent`
        *   **Inputs:** Section 2; outputs of `I2.T1`.
        *   **Input Files:** ["assets/js/admin-tour-features.js","assets/js/admin.js"]
        *   **Target Files:** ["assets/js/admin-tour-features.js","assets/js/admin.js"]
        *   **Deliverables:** Updated JS files with function declarations or reordered definitions, delegated event bindings, and console logging toggles.
        *   **Acceptance Criteria:** Functions referenced before definition are converted to hoisted declarations; `.rename-tour` and modal handlers fire with console confirmations; `node --check` (or eslint) passes; change URL modal triggers AJAX successfully.
        *   **Dependencies:** [I2.T1]
        *   **Parallelizable:** No
    *   **Task 2.4:**
        *   **Task ID:** `I2.T4`
        *   **Description:** Implement UI refresh hooks post-successful AJAX calls so tables, embeds, and redirect notices update without manual reload; ensure old URLs redirect.
        *   **Agent Type Hint:** `FullstackAgent`
        *   **Inputs:** Section 2; outputs of `I2.T1`–`I2.T3`.
        *   **Input Files:** ["assets/js/admin-tour-features.js","assets/js/admin.js","includes/class-h3tm-admin.php","includes/class-h3tm-url-redirector.php"]
        *   **Target Files:** ["assets/js/admin-tour-features.js","assets/js/admin.js","includes/class-h3tm-admin.php","includes/class-h3tm-url-redirector.php"]
        *   **Deliverables:** JS enhancements for table refresh/embed updates and PHP adjustments ensuring legacy URLs redirect after slug changes.
        *   **Acceptance Criteria:** On slug change, UI updates the table row and embed snippet; old slug yields 301 to new slug; console logs confirm success branch; lint checks pass (`node --check`, `php -l`).
        *   **Dependencies:** [I2.T3]
        *   **Parallelizable:** No
    *   **Task 2.5:**
        *   **Task ID:** `I2.T5`
        *   **Description:** Capture the Change URL workflow in a Mermaid sequence diagram incorporating UI, PHP, metadata, redirector, and S3 (if relevant).
        *   **Agent Type Hint:** `DiagrammingAgent`
        *   **Inputs:** Sections 2 & 4; outputs of `I2.T2`–`I2.T4`.
        *   **Input Files:** ["api/admin-ajax.yaml","docs/requirements/critical-bugs.md"]
        *   **Target Files:** ["docs/diagrams/change-url-sequence.mmd"]
        *   **Deliverables:** Mermaid sequence diagram for Change URL with success/error branches.
        *   **Acceptance Criteria:** Diagram reflects final implementation; Mermaid renders cleanly; notes highlight redirect + embed updates.
        *   **Dependencies:** [I2.T2, I2.T4]
        *   **Parallelizable:** No

---

### Iteration 3: Trait-Based Refactor of Admin Logic

*   **Iteration ID:** `I3`
*   **Goal:** Reduce complexity of `class-h3tm-admin.php` by extracting cohesive traits, updating autoloading, and preserving behaviour through testing.
*   **Prerequisites:** `I2`
*   **Tasks:**
    *   **Task 3.1:**
        *   **Task ID:** `I3.T1`
        *   **Description:** Author an ADR documenting the trait refactor strategy, migration steps, and rollback considerations.
        *   **Agent Type Hint:** `DocumentationAgent`
        *   **Inputs:** Sections 2 & 3; outputs of `I2.T2`.
        *   **Input Files:** ["docs/requirements/critical-bugs.md","api/admin-ajax.yaml"]
        *   **Target Files:** ["docs/adr/0001-admin-traits.md"]
        *   **Deliverables:** Markdown ADR capturing motivation, options considered, and decision outcomes.
        *   **Acceptance Criteria:** ADR follows MADR structure (Context, Decision, Consequences); references trait files planned; links to relevant tasks.
        *   **Dependencies:** [I2.T2]
        *   **Parallelizable:** No
    *   **Task 3.2:**
        *   **Task ID:** `I3.T2`
        *   **Description:** Establish `includes/traits/` directory and extract tour handler methods into `trait-h3tm-tour-handlers.php`, updating `H3TM_Admin` to `use` the trait.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Section 3; outputs of `I3.T1`.
        *   **Input Files:** ["includes/class-h3tm-admin.php","docs/adr/0001-admin-traits.md"]
        *   **Target Files:** ["includes/class-h3tm-admin.php","includes/traits/trait-h3tm-tour-handlers.php"]
        *   **Deliverables:** New trait file with namespace/guards consistent with plugin style and updated admin class referencing it.
        *   **Acceptance Criteria:** Methods moved without behavioural change; `require` or autoload ensures trait availability; `php -l` passes; unit/manual tests for tour handlers succeed.
        *   **Dependencies:** [I3.T1]
        *   **Parallelizable:** No
    *   **Task 3.3:**
        *   **Task ID:** `I3.T3`
        *   **Description:** Extract delete and rename handlers into `trait-h3tm-delete-rename.php`, ensuring logging and metadata usage remain intact.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Section 3; outputs of `I3.T2`.
        *   **Input Files:** ["includes/class-h3tm-admin.php","includes/traits/trait-h3tm-tour-handlers.php","docs/adr/0001-admin-traits.md"]
        *   **Target Files:** ["includes/class-h3tm-admin.php","includes/traits/trait-h3tm-delete-rename.php"]
        *   **Deliverables:** Trait file containing delete/rename methods with proper access to shared helpers, updated admin class.
        *   **Acceptance Criteria:** Traits load without fatal errors; delete/rename flows pass manual tests from docs; logging remains; `php -l` passes.
        *   **Dependencies:** [I3.T2]
        *   **Parallelizable:** No
    *   **Task 3.4:**
        *   **Task ID:** `I3.T4`
        *   **Description:** Extract S3 helper methods (presign, upload, cleanup) into `trait-h3tm-s3-operations.php` and adjust references.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Section 3; outputs of `I3.T3`.
        *   **Input Files:** ["includes/class-h3tm-admin.php","docs/adr/0001-admin-traits.md"]
        *   **Target Files:** ["includes/class-h3tm-admin.php","includes/traits/trait-h3tm-s3-operations.php"]
        *   **Deliverables:** Trait encapsulating S3-related admin helpers with shared configuration, updated admin class wiring.
        *   **Acceptance Criteria:** Trait composes cleanly with other traits; S3 operations still reference metadata `s3_folder`; `php -l` clean; manual smoke tests for upload/update succeed.
        *   **Dependencies:** [I3.T3]
        *   **Parallelizable:** No
    *   **Task 3.5:**
        *   **Task ID:** `I3.T5`
        *   **Description:** Extract migration and page rendering logic into respective traits (`trait-h3tm-migration.php`, `trait-h3tm-page-renderers.php`) and slim the admin class to orchestration duties.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Section 3; outputs of `I3.T4`.
        *   **Input Files:** ["includes/class-h3tm-admin.php","docs/adr/0001-admin-traits.md"]
        *   **Target Files:** ["includes/class-h3tm-admin.php","includes/traits/trait-h3tm-migration.php","includes/traits/trait-h3tm-page-renderers.php"]
        *   **Deliverables:** Two trait files containing migration/page rendering code; refactored admin class around 300–400 lines; updated requires/autoloaders.
        *   **Acceptance Criteria:** Admin pages render correctly; migrations run without errors; class file length reduced below 400 lines; `php -l` passes for all new files.
        *   **Dependencies:** [I3.T4]
        *   **Parallelizable:** No

---

### Iteration 4: Modernize Admin UX & Feedback Loops

*   **Iteration ID:** `I4`
*   **Goal:** Deliver a reorganized admin table with search/filter, bulk actions, progress feedback, and confirmation dialogs aligned with documented UX.
*   **Prerequisites:** `I3`
*   **Tasks:**
    *   **Task 4.1:**
        *   **Task ID:** `I4.T1`
        *   **Description:** Produce a UX wireframe and interaction notes for the tour table, including search, filters, bulk actions, progress indicators, and confirmation flows.
        *   **Agent Type Hint:** `UXDocumentationAgent`
        *   **Inputs:** Sections 2 & 3; outputs of `I1.T2`, `I2.T2`, `I3.T5`.
        *   **Input Files:** ["docs/requirements/critical-bugs.md","docs/diagrams/component-overview.puml","api/admin-ajax.yaml"]
        *   **Target Files:** ["docs/ux/admin-table-wireframe.md"]
        *   **Deliverables:** Markdown document with ASCII wireframes, interaction notes, and accessibility considerations.
        *   **Acceptance Criteria:** Wireframe covers search, filter, bulk actions, progress, confirmations; documents keyboard/accessibility expectations; references supporting backend endpoints.
        *   **Dependencies:** [I3.T5]
        *   **Parallelizable:** No
    *   **Task 4.2:**
        *   **Task ID:** `I4.T2`
        *   **Description:** Implement search, filtering, and bulk selection UI in PHP/JS based on the wireframe, returning filtered data via existing handlers.
        *   **Agent Type Hint:** `FullstackAgent`
        *   **Inputs:** Sections 2 & 3; outputs of `I4.T1`.
        *   **Input Files:** ["includes/traits/trait-h3tm-page-renderers.php","assets/js/admin.js"]
        *   **Target Files:** ["includes/traits/trait-h3tm-page-renderers.php","assets/js/admin.js","docs/ux/admin-table-wireframe.md"]
        *   **Deliverables:** Updated renderer for table with search/filter controls, JS handling UI interactions, and documentation updates on UX notes if needed.
        *   **Acceptance Criteria:** Search/filter inputs alter table results without full page reload; bulk checkboxes support select-all; manual instructions updated; lint checks pass.
        *   **Dependencies:** [I4.T1]
        *   **Parallelizable:** No
    *   **Task 4.3:**
        *   **Task ID:** `I4.T3`
        *   **Description:** Implement progress polling (using S3 `status.json`) with visual indicators and estimated completion times.
        *   **Agent Type Hint:** `FrontendAgent`
        *   **Inputs:** Sections 2 & 3; outputs of `I4.T2`.
        *   **Input Files:** ["assets/js/admin-tour-features.js","includes/traits/trait-h3tm-tour-handlers.php"]
        *   **Target Files:** ["assets/js/admin-tour-features.js","includes/traits/trait-h3tm-tour-handlers.php","docs/ux/admin-table-wireframe.md"]
        *   **Deliverables:** JS polling module, backend endpoint (if required) to proxy S3 status, and UX doc updates describing progress behaviour.
        *   **Acceptance Criteria:** Processing tours display live percentage/ETA; polling stops on completion/error; logging captures poll failures; lint checks pass.
        *   **Dependencies:** [I4.T2]
        *   **Parallelizable:** No
    *   **Task 4.4:**
        *   **Task ID:** `I4.T4`
        *   **Description:** Add confirmation dialogs for destructive actions (delete, archive, bulk actions) and toast notifications for successes/failures.
        *   **Agent Type Hint:** `FrontendAgent`
        *   **Inputs:** Section 2; outputs of `I4.T2`.
        *   **Input Files:** ["assets/js/admin.js","assets/js/admin-tour-features.js"]
        *   **Target Files:** ["assets/js/admin.js","assets/js/admin-tour-features.js","docs/ux/admin-table-wireframe.md"]
        *   **Deliverables:** JS modules for confirmations/toasts, accessible focus management, and UX doc updates.
        *   **Acceptance Criteria:** Confirm dialogs block destructive actions until confirmed; toasts announce results (with ARIA roles); behaviour documented; lint checks pass.
        *   **Dependencies:** [I4.T2]
        *   **Parallelizable:** Yes
    *   **Task 4.5:**
        *   **Task ID:** `I4.T5`
        *   **Description:** Update admin CSS to support new layout, responsiveness, progress bars, and bulk action controls.
        *   **Agent Type Hint:** `FrontendAgent`
        *   **Inputs:** Section 2; outputs of `I4.T1`–`I4.T4`.
        *   **Input Files:** ["assets/css/admin.css","docs/ux/admin-table-wireframe.md"]
        *   **Target Files:** ["assets/css/admin.css"]
        *   **Deliverables:** Revised CSS with variables/mixins as needed, ensuring compatibility with WP admin styles.
        *   **Acceptance Criteria:** UI renders cleanly across standard WP admin breakpoints; progress bars and dropdowns styled per wireframe; passes `stylelint` (if available) or manual review.
        *   **Dependencies:** [I4.T4]
        *   **Parallelizable:** No

## 5. Verification and Integration Strategy

*   **Testing Levels:** Unit tests for metadata operations and S3 helpers (`tests/php`); integration tests using WP test harness for AJAX endpoints (e.g., Change URL, Rename, Rebuild metadata); manual end-to-end scripts in `tests/manual/` for destructive operations and UX flows (delete, bulk actions, progress).
*   **CI/CD:** Recommend GitHub Actions (or equivalent) pipeline running `composer install`, `composer test`, `npm install`, `npm run lint`, `npm run build`, plus OpenAPI validation (e.g., `npx swagger-cli validate api/admin-ajax.yaml`) and Mermaid/PlantUML linting via CLI.
*   **Code Quality Gates:** Enforce `php -l` on all PHP files, PHPUnit green status (>=85% coverage on critical modules), ESLint/Prettier clean JS, Stylelint for CSS, and static analysis (Psalm or PHPStan level 3+) once traits stabilize.
*   **Artifact Validation:** Diagrams rendered via CI (PlantUML CLI, Mermaid CLI); OpenAPI spec validated; ADR reviewed during PR; manual test checklists updated when workflows change with reviewer sign-off.

## 6. Glossary

*   **H3TM:** H3 Tour Management WordPress plugin component set.
*   **Trait:** PHP language construct used to compose reusable method groups into classes, enabling modularization of `H3TM_Admin`.
*   **admin-ajax:** WordPress endpoint (`wp-admin/admin-ajax.php`) processing AJAX requests registered via `add_action('wp_ajax_*')`.
*   **S3 Folder (Prefix):** Canonical S3 path (e.g., `tours/Jeffs Test/`) stored in metadata and used for all AWS operations.
*   **status.json:** S3 object written by Lambda containing processing progress, polled by the admin UI for updates.
*   **ADR:** Architectural Decision Record capturing context, decision, and consequences for significant changes.
