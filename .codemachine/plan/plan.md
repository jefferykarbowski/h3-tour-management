# Project Plan: H3 Tour Management Plugin Revamp

**Version:** 1.0
**Date:** 2025-10-09
**Generated By:** Codex (GPT-5)

## 1. Project Overview

*   **Goal:** Restore and modernize the H3 Tour Management WordPress plugin by fixing critical AWS integration bugs, refactoring the admin codebase for maintainability, and delivering an improved admin UX.
*   **High-Level Requirements Summary:**
    - Resolve Delete, Change URL, Rename, Update/Get Script, and Rebuild Metadata defects with thorough logging and edge-case coverage.
    - Ensure all S3 interactions rely on `metadata.s3_folder` and maintain accurate URL redirect history.
    - Refactor the monolithic `H3TM_Admin` class into cohesive PHP traits without breaking functionality.
    - Redesign the admin tour management UI with search/filter, bulk actions, progress feedback, and confirmation dialogs.
    - Provide verification artifacts (diagrams, specs, docs) to guide autonomous development agents.
*   **Key Assumptions:**
    - WordPress ≥5.8, PHP ≥7.4, and MySQL are available with existing plugin deployment.
    - AWS credentials with S3, CloudFront, and Lambda access are configured for the environment.
    - Lambda continues to create S3 folders that preserve spaces and can emit optional status JSON files.
    - Existing CSS/JS build pipeline remains jQuery-based; introducing new major frameworks is out of scope.
    - Plugin regression testing will be primarily manual with linting and targeted automated checks.

## 2. Core Architecture

*   **Architectural Style:** Layered WordPress plugin (modular traits) with serverless processing (AWS Lambda) and CDN delivery (CloudFront).
*   **Technology Stack:**
    *   Frontend: WordPress Admin UI, PHP templates, jQuery, WordPress media uploader.
    *   Backend: PHP 7.4+ within WordPress, AWS SDK for PHP v3, WordPress AJAX hooks.
    *   Database: MySQL (table `wp_h3tm_tour_metadata`).
    *   Messaging/Queues: Lambda-triggered S3 events (existing); no additional queues planned.
    *   Deployment: WordPress plugin package; AWS Lambda (zip deployment); CloudFront invalidations via AWS SDK.
    *   Other Key Libraries/Tools: WordPress nonces/capabilities, PSR-3-compatible logging wrapper (or `error_log`), optional WP-CLI utilities.
*   **Key Components/Services:** H3TM_Admin core controller, trait modules for tour handlers, delete/rename, S3 operations, migration, and page rendering; H3TM_Tour_Metadata repository; H3TM_S3_Simple service; H3TM_URL_Redirector; Admin JS bundle (`admin.js`, `admin-tour-features.js`). *Component Diagram (PlantUML) planned in I1.T1.*
*   **Data Model Overview:** Single metadata table storing slug, display name, canonical S3 folder (with spaces), and URL history (JSON). *Entity Relationship Diagram (PlantUML) planned in I1.T1.*
*   **API Contract Style:** WordPress AJAX endpoints documented as structured JSON payloads. *Admin AJAX contract reference (Markdown) planned in I2.T1.*
*   **Communication Patterns:** Admin JS issues AJAX requests to WordPress; plugin interacts with AWS services synchronously; Lambda processes uploads and optionally writes status JSON for polling; URL redirects handled on `template_redirect`. *Sequence Diagram (PlantUML) for Change URL flow planned in I2.T1; Admin JS flow diagram (Mermaid) planned in I3.T1.*

## 2.1. Key Architectural Artifacts Planned

*   Component Diagram (PlantUML) – Visualize plugin components and AWS integrations (Created in I1.T1; file `docs/diagrams/h3tm_component.puml`).
*   Data Model ERD (PlantUML) – Document `wp_h3tm_tour_metadata` schema and relationships (Created in I1.T1; file `docs/diagrams/h3tm_data_model.puml`).
*   S3 Operations Audit Note (Markdown) – Summarize metadata-driven S3 rules and logging approach (Created in I1.T2; file `docs/notes/s3-operations.md`).
*   Admin AJAX Contract Reference (Markdown) – Document key AJAX actions, payloads, and responses (Created in I2.T1; file `api/admin_ajax_contract.md`).
*   Change URL Sequence Diagram (PlantUML) – Detail end-to-end slug change flow (Created in I2.T1; file `docs/diagrams/change_url_sequence.puml`).
*   Admin JS Interaction Flow (Mermaid) – Map modal/event lifecycle for tour actions (Created in I3.T1; file `docs/diagrams/admin_js_flow.mmd`).
*   Refactor ADR (Markdown) – Capture trait extraction decisions and impacts (Created in I4.T1; file `docs/adr/0001-admin-traits.md`).
*   Tour Table Wireframe (Mermaid) – Illustrate redesigned UX layout (Created in I5.T1; file `docs/diagrams/tour_table_wireframe.mmd`).

## 3. Directory Structure

*   **Root Directory:** `h3tm-plugin/`
*   **Structure Definition:**
    ~~~
    h3tm-plugin/
    ├── h3-tour-management.php
    ├── includes/
    │   ├── class-h3tm-admin.php
    │   ├── class-h3tm-activator.php
    │   ├── class-h3tm-s3-simple.php
    │   ├── class-h3tm-tour-metadata.php
    │   ├── class-h3tm-url-redirector.php
    │   └── traits/                 # New trait modules introduced during refactor
    │       ├── trait-h3tm-tour-handlers.php
    │       ├── trait-h3tm-delete-rename.php
    │       ├── trait-h3tm-s3-operations.php
    │       ├── trait-h3tm-migration.php
    │       └── trait-h3tm-page-renderers.php
    ├── assets/
    │   ├── css/
    │   │   └── admin.css
    │   └── js/
    │       ├── admin.js
    │       └── admin-tour-features.js
    ├── api/                        # API/contract references for AJAX endpoints
    │   └── admin_ajax_contract.md
    ├── docs/
    │   ├── diagrams/               # PlantUML/Mermaid sources
    │   │   ├── h3tm_component.puml
    │   │   ├── h3tm_data_model.puml
    │   │   ├── change_url_sequence.puml
    │   │   ├── admin_js_flow.mmd
    │   │   └── tour_table_wireframe.mmd
    │   ├── notes/
    │   │   └── s3-operations.md
    │   └── adr/
    │       └── 0001-admin-traits.md
    ├── tests/                      # Future automated tests (PHPUnit/JS)
    ├── bin/                        # Optional WP-CLI helpers or scripts
    ├── composer.json               # If AWS SDK managed via Composer
    ├── package.json                # For JS lint/build tooling (if needed)
    ├── README.md
    └── docs/plan.md                # Symlink/copy of this plan if desired
    ~~~
    Key deviations: introduction of `docs/notes/` and `docs/adr/` for planning artifacts, and `api/` for AJAX contract documentation to support autonomous agents.

## 4. Iteration Plan

*   **Total Iterations Planned:** 5
*   **Iteration Dependencies:** `I2` depends on completion of `I1`; `I3` depends on `I1` and `I2`; `I4` requires `I1`–`I3` to stabilize functionality before refactor; `I5` builds on refactored structure from `I4`.

---

### Iteration 1: Metadata-Driven S3 Deletion Foundations

*   **Iteration ID:** `I1`
*   **Goal:** Fix the Delete Tour failure by enforcing metadata-driven S3 paths and establish logging/architecture artifacts for future work.
*   **Prerequisites:** None
*   **Tasks:**
    *   **Task 1.1:**
        *   **Task ID:** `I1.T1`
        *   **Description:** Generate component and data model diagrams capturing current plugin architecture and metadata usage to guide subsequent fixes.
        *   **Agent Type Hint:** `DiagrammingAgent`
        *   **Inputs:** Section 2 of this plan; existing PHP classes in `includes/`
        *   **Input Files:** [`includes/class-h3tm-admin.php`, `includes/class-h3tm-s3-simple.php`, `includes/class-h3tm-tour-metadata.php`]
        *   **Target Files:** [`docs/diagrams/h3tm_component.puml`, `docs/diagrams/h3tm_data_model.puml`]
        *   **Deliverables:** PlantUML component diagram file; PlantUML ERD file.
        *   **Acceptance Criteria:** 
          - PlantUML files render without syntax errors.
          - Diagrams reflect components and data fields described in Section 2.
          - Stored under `docs/diagrams/` with meaningful titles.
        *   **Dependencies:** []
        *   **Parallelizable:** No
    *   **Task 1.2:**
        *   **Task ID:** `I1.T2`
        *   **Description:** Document S3 metadata usage rules and enhance `archive_tour()` to rely on `metadata.s3_folder`, adding verbose logging for deletion flows.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Output from `I1.T1`; requirements (Critical Bug #1 section).
        *   **Input Files:** [`includes/class-h3tm-s3-simple.php`, `includes/class-h3tm-tour-metadata.php`]
        *   **Target Files:** [`includes/class-h3tm-s3-simple.php`, `docs/notes/s3-operations.md`]
        *   **Deliverables:** Updated PHP logic using metadata-derived S3 paths; Markdown note summarizing S3 deletion rules and logging strategy.
        *   **Acceptance Criteria:** 
          - `archive_tour()` reads `s3_folder` via metadata instead of sanitizing display names.
          - Additional logging statements capture S3 paths and outcomes.
          - Markdown note lists test scenarios (spaces, hyphens, special chars) and logging expectations.
          - `php -l includes/class-h3tm-s3-simple.php` passes.
        *   **Dependencies:** [`I1.T1`]
        *   **Parallelizable:** No
    *   **Task 1.3:**
        *   **Task ID:** `I1.T3`
        *   **Description:** Update deletion-related unit tests or add manual test script instructions ensuring tours with varied names delete successfully.
        *   **Agent Type Hint:** `TestingAgent`
        *   **Inputs:** Updated deletion logic (`I1.T2`), testing checklist in requirements.
        *   **Input Files:** [`includes/class-h3tm-s3-simple.php`]
        *   **Target Files:** [`docs/notes/s3-operations.md`, `tests/manual/delete-tour.md`]
        *   **Deliverables:** Expanded Markdown note with test validations; new manual test script under `tests/manual/delete-tour.md`.
        *   **Acceptance Criteria:** 
          - Manual test script outlines steps for multiple tour name variations and expected outcomes.
          - Note references logging entries to verify during testing.
          - Files use consistent Markdown formatting and reside in specified directories.
        *   **Dependencies:** [`I1.T2`]
        *   **Parallelizable:** Yes

---

### Iteration 2: Change URL & Rename Stabilization

*   **Iteration ID:** `I2`
*   **Goal:** Restore Change URL and Rename functionality across backend and frontend with documented AJAX contracts and refreshed UI behavior.
*   **Prerequisites:** `I1`
*   **Tasks:**
    *   **Task 2.1:**
        *   **Task ID:** `I2.T1`
        *   **Description:** Document AJAX contracts and produce Change URL sequence diagram to anchor backend/front-end coordination.
        *   **Agent Type Hint:** `DocumentationAgent`
        *   **Inputs:** Section 2 communication patterns; bug details for Change URL.
        *   **Input Files:** [`includes/class-h3tm-admin.php`, `includes/class-h3tm-tour-metadata.php`, `assets/js/admin-tour-features.js`]
        *   **Target Files:** [`api/admin_ajax_contract.md`, `docs/diagrams/change_url_sequence.puml`]
        *   **Deliverables:** Markdown AJAX reference covering relevant actions; PlantUML sequence diagram for Change URL flow.
        *   **Acceptance Criteria:** 
          - AJAX contract lists request/response schemas, nonces, and success/error codes.
          - Sequence diagram reflects steps from UI trigger to redirect activation.
          - Files render without syntax errors and align with terminology from Section 2.
        *   **Dependencies:** []
        *   **Parallelizable:** No
    *   **Task 2.2:**
        *   **Task ID:** `I2.T2`
        *   **Description:** Fix Change URL backend by ensuring AJAX action registration, callable handler, metadata updates, and redirect integration with detailed logging.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** AJAX contract (`I2.T1`); Critical Bug #2 requirements.
        *   **Input Files:** [`includes/class-h3tm-admin.php`, `includes/class-h3tm-tour-metadata.php`, `includes/class-h3tm-url-redirector.php`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `includes/class-h3tm-tour-metadata.php`, `includes/class-h3tm-url-redirector.php`, `logs/h3tm-debug.log`]
        *   **Deliverables:** Updated PHP handlers with slug change logging; redirector enhancements; optional log stub or config entry.
        *   **Acceptance Criteria:** 
          - AJAX action `h3tm_change_tour_url` registered in constructor and callable.
          - Metadata method appends old slug to `url_history` and logs success/failure.
          - Redirector resolves legacy slugs via updated history.
          - PHP lint passes for all modified files.
        *   **Dependencies:** [`I2.T1`]
        *   **Parallelizable:** No
    *   **Task 2.3:**
        *   **Task ID:** `I2.T3`
        *   **Description:** Update Change URL modal workflow in JS to refresh UI, update embed code, and surface success/error messages.
        *   **Agent Type Hint:** `FrontendAgent`
        *   **Inputs:** AJAX contract and backend response shape from `I2.T2`.
        *   **Input Files:** [`assets/js/admin-tour-features.js`, `assets/js/admin.js`]
        *   **Target Files:** [`assets/js/admin-tour-features.js`, `assets/js/admin.js`]
        *   **Deliverables:** Refined JS handlers with proper function hoisting, UI refresh logic, and console logging for debugging.
        *   **Acceptance Criteria:** 
          - Change URL flow triggers AJAX request, handles success/failure, and updates table row and embed snippet.
          - Functions defined as declarations or moved before usage to avoid hoisting issues.
          - Node syntax check (`node -c`) passes on modified JS files.
        *   **Dependencies:** [`I2.T2`]
        *   **Parallelizable:** Yes
    *   **Task 2.4:**
        *   **Task ID:** `I2.T4`
        *   **Description:** Repair Rename Tour backend/frontend path ensuring modal display, AJAX submission, and table refresh.
        *   **Agent Type Hint:** `FullstackAgent`
        *   **Inputs:** Bug #3 requirements; outputs from `I2.T2` leveraging shared admin infrastructure.
        *   **Input Files:** [`includes/class-h3tm-admin.php`, `assets/js/admin.js`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `assets/js/admin.js`]
        *   **Deliverables:** Working rename handler with capability/nonce checks and updated JS event delegation.
        *   **Acceptance Criteria:** 
          - Rename button opens modal and submits new display name.
          - Backend updates metadata without affecting slug.
          - Tour list refreshes to show new name; logging captures operation.
          - PHP and JS lint checks pass.
        *   **Dependencies:** [`I2.T2`]
        *   **Parallelizable:** Yes

---

### Iteration 3: Update/Get Script & Metadata Rebuild Reliability

*   **Iteration ID:** `I3`
*   **Goal:** Restore Update Tour, Get Script, and Rebuild Metadata functionality while stabilizing admin JS execution order and documenting interaction flows.
*   **Prerequisites:** `I1`, `I2`
*   **Tasks:**
    *   **Task 3.1:**
        *   **Task ID:** `I3.T1`
        *   **Description:** Produce a Mermaid diagram of admin JS interaction flow to guide hoisting fixes and modal sequencing.
        *   **Agent Type Hint:** `DiagrammingAgent`
        *   **Inputs:** Updated JS from `I2.T3`; Bug #4 and #5 requirements.
        *   **Input Files:** [`assets/js/admin-tour-features.js`, `assets/js/admin.js`]
        *   **Target Files:** [`docs/diagrams/admin_js_flow.mmd`]
        *   **Deliverables:** Mermaid flow diagram describing modal creation, AJAX calls, and success/error handling.
        *   **Acceptance Criteria:** 
          - Diagram renders in Mermaid preview without errors.
          - Nodes include Update, Get Script, Change URL, Rename, Rebuild Metadata flows.
          - File stored under `docs/diagrams/`.
        *   **Dependencies:** [`I2.T3`]
        *   **Parallelizable:** Yes
    *   **Task 3.2:**
        *   **Task ID:** `I3.T2`
        *   **Description:** Reorder or refactor JS functions for Update/Get Script buttons to ensure hoisting, attach console diagnostics, and validate resource loading.
        *   **Agent Type Hint:** `FrontendAgent`
        *   **Inputs:** Interaction flow diagram (`I3.T1`); Bug #4 requirements.
        *   **Input Files:** [`assets/js/admin-tour-features.js`]
        *   **Target Files:** [`assets/js/admin-tour-features.js`]
        *   **Deliverables:** Updated JS with function declarations, logging, and cache-busting hook (version bump in enqueue).
        *   **Acceptance Criteria:** 
          - Functions used before definition are converted to declarations or relocated.
          - Console logs confirm handler execution paths.
          - Enqueued script version updated to invalidate cache.
          - `node -c assets/js/admin-tour-features.js` passes.
        *   **Dependencies:** [`I3.T1`]
        *   **Parallelizable:** No
    *   **Task 3.3:**
        *   **Task ID:** `I3.T3`
        *   **Description:** Ensure Update Tour backend workflow triggers Lambda, tracks progress (status JSON lookup), and invalidates CloudFront when complete.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** Bug #4 requirements; JS changes from `I3.T2`.
        *   **Input Files:** [`includes/class-h3tm-admin.php`, `includes/class-h3tm-s3-simple.php`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `includes/class-h3tm-s3-simple.php`, `docs/notes/update-tour.md`]
        *   **Deliverables:** Backend updates for progress polling, logging, and CloudFront invalidation steps; documentation note for testing.
        *   **Acceptance Criteria:** 
          - Update handler fetches metadata-derived S3 folder and logs process.
          - Optional status JSON polling endpoint documented.
          - CloudFront invalidation invoked post-success with error handling.
          - PHP lint passes; documentation outlines verification steps.
        *   **Dependencies:** [`I3.T2`]
        *   **Parallelizable:** No
    *   **Task 3.4:**
        *   **Task ID:** `I3.T4`
        *   **Description:** Restore Get Script modal and Rebuild Metadata button behavior with AJAX registration, logging, and UI feedback.
        *   **Agent Type Hint:** `FullstackAgent`
        *   **Inputs:** Bug #4 and #5 requirements; outputs from `I3.T2`.
        *   **Input Files:** [`includes/class-h3tm-admin.php`, `assets/js/admin-tour-features.js`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `assets/js/admin-tour-features.js`, `logs/h3tm-debug.log`]
        *   **Deliverables:** Functional Get Script modal with copy feedback; working Rebuild Metadata handler with console and PHP logs.
        *   **Acceptance Criteria:** 
          - AJAX actions `h3tm_get_embed_script` and `h3tm_rebuild_metadata` registered and secured with nonces.
          - UI displays confirmation or error messages; console logs for debugging.
          - Manual test instructions updated with success criteria.
        *   **Dependencies:** [`I3.T2`, `I3.T3`]
        *   **Parallelizable:** Yes

---

### Iteration 4: Admin Trait Refactor

*   **Iteration ID:** `I4`
*   **Goal:** Decompose `H3TM_Admin` into modular traits while preserving functionality and establishing architectural decision documentation.
*   **Prerequisites:** `I1`, `I2`, `I3`
*   **Tasks:**
    *   **Task 4.1:**
        *   **Task ID:** `I4.T1`
        *   **Description:** Draft an ADR detailing trait decomposition strategy, method ownership, and verification steps prior to refactoring.
        *   **Agent Type Hint:** `DocumentationAgent`
        *   **Inputs:** Refactor requirements; outputs from prior iterations.
        *   **Input Files:** [`includes/class-h3tm-admin.php`]
        *   **Target Files:** [`docs/adr/0001-admin-traits.md`]
        *   **Deliverables:** Markdown ADR capturing context, decision, consequences, and migration plan.
        *   **Acceptance Criteria:** 
          - ADR lists proposed trait files and responsibilities.
          - Includes testing checklist to run after each extraction.
          - Written in standard ADR template (Context, Decision, Consequences).
        *   **Dependencies:** []
        *   **Parallelizable:** Yes
    *   **Task 4.2:**
        *   **Task ID:** `I4.T2`
        *   **Description:** Extract tour action handlers into `trait-h3tm-tour-handlers.php` and wire into main class.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** ADR (`I4.T1`); stabilized handlers from earlier iterations.
        *   **Input Files:** [`includes/class-h3tm-admin.php`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `includes/traits/trait-h3tm-tour-handlers.php`]
        *   **Deliverables:** New trait file containing tour handler methods; updated admin class using the trait.
        *   **Acceptance Criteria:** 
          - All tour handler methods relocated with no functional change.
          - Namespaces and visibility preserved; `use Trait` statement added.
          - PHP lint passes and manual smoke test checklist executed.
        *   **Dependencies:** [`I4.T1`]
        *   **Parallelizable:** No
    *   **Task 4.3:**
        *   **Task ID:** `I4.T3`
        *   **Description:** Extract delete/rename handlers into dedicated trait with supporting unit/manual tests updated.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** ADR (`I4.T1`); outputs from `I4.T2`.
        *   **Input Files:** [`includes/class-h3tm-admin.php`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `includes/traits/trait-h3tm-delete-rename.php`, `tests/manual/delete-tour.md`]
        *   **Deliverables:** Trait file for delete/rename; updated test documentation referencing trait location.
        *   **Acceptance Criteria:** 
          - Delete and rename methods removed from main class and present in trait.
          - Test documentation updated with new file references.
          - PHP lint passes.
        *   **Dependencies:** [`I4.T2`]
        *   **Parallelizable:** No
    *   **Task 4.4:**
        *   **Task ID:** `I4.T4`
        *   **Description:** Extract S3 helper methods into trait, ensuring logging consistency and shared utilities remain accessible.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** ADR (`I4.T1`); previous traits.
        *   **Input Files:** [`includes/class-h3tm-admin.php`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `includes/traits/trait-h3tm-s3-operations.php`]
        *   **Deliverables:** S3 operations trait containing helper methods; admin class updated to use trait.
        *   **Acceptance Criteria:** 
          - Shared properties/methods referenced via `$this` remain accessible.
          - Logging statements retained or improved.
          - PHP lint passes.
        *   **Dependencies:** [`I4.T3`]
        *   **Parallelizable:** Yes
    *   **Task 4.5:**
        *   **Task ID:** `I4.T5`
        *   **Description:** Extract migration helpers and page renderers into respective traits, finalizing class size reduction.
        *   **Agent Type Hint:** `BackendAgent`
        *   **Inputs:** ADR (`I4.T1`); previous trait extractions.
        *   **Input Files:** [`includes/class-h3tm-admin.php`]
        *   **Target Files:** [`includes/class-h3tm-admin.php`, `includes/traits/trait-h3tm-migration.php`, `includes/traits/trait-h3tm-page-renderers.php`]
        *   **Deliverables:** Migration and page renderer traits; admin class referencing all traits; updated class docblock summarizing responsibilities.
        *   **Acceptance Criteria:** 
          - Main class shrinks below 400 lines; each trait under ~300 lines.
          - `composer dump-autoload` (if applicable) reflects new files; autoload config updated if required.
          - Full manual regression checklist executed with no regressions logged.
        *   **Dependencies:** [`I4.T4`]
        *   **Parallelizable:** No

---

### Iteration 5: Admin UX Modernization

*   **Iteration ID:** `I5`
*   **Goal:** Implement prioritized UX improvements (search/filter, bulk actions, progress indicators, confirmations) atop the refactored codebase.
*   **Prerequisites:** `I4`
*   **Tasks:**
    *   **Task 5.1:**
        *   **Task ID:** `I5.T1`
        *   **Description:** Produce Mermaid wireframe reflecting target tour table layout with search/filter controls and action hierarchy.
        *   **Agent Type Hint:** `UXDesignerAgent`
        *   **Inputs:** UX requirements; existing admin markup.
        *   **Input Files:** [`includes/class-h3tm-admin.php`, `assets/js/admin.js`, `assets/css/admin.css`]
        *   **Target Files:** [`docs/diagrams/tour_table_wireframe.mmd`]
        *   **Deliverables:** Mermaid diagram describing primary/secondary actions, bulk toolbar, progress indicators.
        *   **Acceptance Criteria:** 
          - Diagram matches requirements (search, filter, bulk, progress, confirmation triggers).
          - Renderable via Mermaid with no errors.
        *   **Dependencies:** []
        *   **Parallelizable:** Yes
    *   **Task 5.2:**
        *   **Task ID:** `I5.T2`
        *   **Description:** Implement searchable/filterable tour table with bulk selection and dropdown actions in PHP and JS.
        *   **Agent Type Hint:** `FullstackAgent`
        *   **Inputs:** Wireframe (`I5.T1`); AJAX contract doc (`I2.T1`).
        *   **Input Files:** [`includes/traits/trait-h3tm-page-renderers.php`, `assets/js/admin.js`, `assets/css/admin.css`]
        *   **Target Files:** [`includes/traits/trait-h3tm-page-renderers.php`, `assets/js/admin.js`, `assets/css/admin.css`]
        *   **Deliverables:** Updated admin table markup, JS for filtering/bulk actions, CSS tweaks for layout.
        *   **Acceptance Criteria:** 
          - Search input filters results client-side or via AJAX.
          - Bulk dropdown supports at least delete/archive operations with confirmation prompts.
          - Styling aligns with WordPress admin aesthetics; lint checks pass.
        *   **Dependencies:** [`I5.T1`]
        *   **Parallelizable:** No
    *   **Task 5.3:**
        *   **Task ID:** `I5.T3`
        *   **Description:** Add confirmation dialogs and progress polling UI components with reusable modal/toast helpers.
        *   **Agent Type Hint:** `FrontendAgent`
        *   **Inputs:** Wireframe (`I5.T1`); progress infrastructure from `I3.T3`.
        *   **Input Files:** [`assets/js/admin-tour-features.js`, `assets/js/admin.js`, `assets/css/admin.css`]
        *   **Target Files:** [`assets/js/admin-tour-features.js`, `assets/js/admin.js`, `assets/css/admin.css`]
        *   **Deliverables:** JS modules for confirmations, progress display, toasts; CSS updates for progress bars and statuses.
        *   **Acceptance Criteria:** 
          - Delete/Archive actions prompt user before execution.
          - Progress indicators show percentage/ETA when status JSON available.
          - UI gracefully handles missing status data (fallback messaging).
        *   **Dependencies:** [`I5.T2`, `I3.T3`]
        *   **Parallelizable:** Yes
    *   **Task 5.4:**
        *   **Task ID:** `I5.T4`
        *   **Description:** Update documentation and manual regression suite to cover new UX features and ensure embed code remains accurate.
        *   **Agent Type Hint:** `DocumentationAgent`
        *   **Inputs:** Completed UX features (`I5.T2`, `I5.T3`); earlier test docs.
        *   **Input Files:** [`tests/manual/delete-tour.md`, `docs/notes/update-tour.md`]
        *   **Target Files:** [`tests/manual/delete-tour.md`, `tests/manual/ux-regression.md`, `README.md`]
        *   **Deliverables:** Updated manual test scripts, new UX regression checklist, README summary of UX improvements.
        *   **Acceptance Criteria:** 
          - Manual test docs cover search/filter, bulk actions, confirmations, progress.
          - README highlights new UX capabilities and testing instructions.
          - Markdown lint (if available) passes.
        *   **Dependencies:** [`I5.T2`, `I5.T3`]
        *   **Parallelizable:** Yes

## 5. Verification and Integration Strategy

*   **Testing Levels:** Enforce unit-level PHP tests where practical (trait extraction scopes), integration tests for AJAX handlers via manual or WP-CLI scripts, and manual end-to-end browser verifications after each bug fix and UX change. Expand `tests/manual/` scripts per iteration.
*   **CI/CD:** Recommended pipeline: PHP lint (`php -l`), optional `composer test`, Node syntax check (`node -c`), WordPress coding standards (PHPCS) when feasible, and automated validation of PlantUML/Mermaid files (e.g., CI script invoking render checks). Cache-bust JS/CSS via enqueue versioning.
*   **Code Quality Gates:** Require zero PHP/JS lint errors, maintain logging around critical operations, ensure manual regression checklist updated per iteration, and target increasing automated coverage post-refactor.
*   **Artifact Validation:** Diagrams rendered via PlantUML/Mermaid CLI or plugin; Markdown docs reviewed for accuracy; OpenAPI/AJAX contract verified against actual handler responses; logs inspected to confirm instrumentation; peer/agent reviews recommended after each iteration.

## 6. Glossary

*   **ADR:** Architectural Decision Record documenting context, decision, and consequences for significant changes.
*   **S3 Folder:** Canonical S3 key prefix for a tour (e.g., `tours/Jeffs Test/`), sourced from metadata without altering whitespace.
*   **URL History:** JSON array in metadata tracking previous slugs to support 301 redirects via `H3TM_URL_Redirector`.
*   **Status JSON:** Optional Lambda-produced file describing processing progress, polled by the admin UI for real-time updates.
*   **Bulk Actions:** Admin UI operations (e.g., delete, archive) applied to multiple selected tours simultaneously with confirmations.

