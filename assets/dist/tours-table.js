import{c as p,r as g,j as e,L as z,B as A,I as q,C as V,h as H,R as B}from"./chunks/index-Gzz08Kjg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=p("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=p("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=p("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=p("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=p("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=p("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=p("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function Q({onRefresh:w}){const[y,M]=g.useState([]),[P,N]=g.useState(!0),[I,T]=g.useState(null),[f,v]=g.useState("");g.useEffect(()=>{m()},[]);const m=async()=>{var t,s;N(!0);try{const o=new FormData;o.append("action","h3tm_list_s3_tours"),o.append("nonce",((t=window.h3tm_ajax)==null?void 0:t.nonce)||"");const d=await(await fetch(((s=window.h3tm_ajax)==null?void 0:s.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:o})).json();if(d.success&&d.data){const x=Array.isArray(d.data)?d.data:d.data.tours||[];M(x.map(r=>{const b=typeof r=="object"&&r.tour_slug?r.tour_slug:typeof r=="string"?r:r.name;return{name:typeof r=="string"?r:r.name,url:window.location.origin+"/h3panos/"+encodeURIComponent(b),status:typeof r=="string"?"completed":r.status,tour_id:typeof r=="string"?void 0:r.tour_id}}))}}catch(o){console.error("Error loading tours:",o)}finally{N(!1)}},O=t=>{T(t),v(t)},j=()=>{T(null),v("")},C=async t=>{var s,o;if(f===t||!f.trim()){j();return}try{const l=new FormData;l.append("action","h3tm_rename_tour"),l.append("old_name",t),l.append("new_name",f),l.append("nonce",((s=window.h3tm_ajax)==null?void 0:s.nonce)||""),(await(await fetch(((o=window.h3tm_ajax)==null?void 0:o.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:l})).json()).success&&(await m(),j())}catch(l){console.error("Error renaming tour:",l)}},h=async(t,s,o)=>{var l,d,x,r,b,S,E,D,L,R,$;switch(t){case"view":window.open(o,"_blank");break;case"changeUrl":const k=prompt("Enter new URL slug (e.g., my-custom-tour-name):",o==null?void 0:o.split("/").pop());if(k&&k.trim())try{let a=k.trim();if(a.includes("/")&&(a=a.split("/").filter(u=>u).pop()||""),!a||a.length===0){alert("Invalid URL slug. Please enter a valid slug.");return}const c=new FormData;c.append("action","h3tm_change_tour_url"),c.append("tour_name",s),c.append("new_slug",a),c.append("nonce",((l=window.h3tm_ajax)==null?void 0:l.nonce)||"");const i=await(await fetch(((d=window.h3tm_ajax)==null?void 0:d.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:c})).json();i.success?(alert(`URL changed successfully for "${s}"
New URL: /h3panos/${a}`),await m()):alert(`Failed to change URL: ${i.data||"Unknown error"}`)}catch(a){console.error("Error changing URL:",a),alert("Failed to change URL. Check console for details.")}break;case"update":if(confirm(`Re-upload and update "${s}"? This will replace the existing tour with a new version.`))try{const a=new FormData;a.append("action","h3tm_update_tour"),a.append("tour_name",s),a.append("nonce",((x=window.h3tm_ajax)==null?void 0:x.nonce)||"");const n=await(await fetch(((r=window.h3tm_ajax)==null?void 0:r.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:a})).json();n.success?(alert(`Update initiated for "${s}". ${n.data||""}`),await m()):alert(`Failed to update: ${n.data||"Unknown error"}`)}catch(a){console.error("Error updating tour:",a),alert("Failed to update tour. Check console for details.")}break;case"rename":O(s);break;case"getScript":try{const a=new FormData;a.append("action","h3tm_get_embed_script"),a.append("tour_name",s),a.append("nonce",((b=window.h3tm_ajax)==null?void 0:b.nonce)||"");const n=await(await fetch(((S=window.h3tm_ajax)==null?void 0:S.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:a})).json();if(n.success&&n.data){const i=n.data.embed_script,u=n.data.embed_script_responsive;navigator.clipboard?(await navigator.clipboard.writeText(i),alert(`Standard embed script copied to clipboard!

For responsive (16:9) version, use:
${u.substring(0,150)}...`)):prompt("Copy the standard embed script below:",i)}else alert(`Failed to get script: ${n.data||"Unknown error"}`)}catch(a){console.error("Error getting script:",a),alert("Failed to get embed script. Check console for details.")}break;case"delete":if(confirm(`Are you sure you want to archive "${s}"? The tour will be moved to the archive folder and permanently deleted after 90 days.`))try{console.log("🗑️ Delete Request Starting:",{tourName:s,ajaxUrl:(E=window.h3tm_ajax)==null?void 0:E.ajax_url,hasNonce:!!((D=window.h3tm_ajax)!=null&&D.nonce),timestamp:new Date().toISOString()});const a=new FormData;a.append("action","h3tm_delete_tour"),a.append("tour_name",s),a.append("nonce",((L=window.h3tm_ajax)==null?void 0:L.nonce)||""),console.log("📤 Sending DELETE request to:",((R=window.h3tm_ajax)==null?void 0:R.ajax_url)||"/wp-admin/admin-ajax.php");const c=await fetch((($=window.h3tm_ajax)==null?void 0:$.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:a});console.log("📥 Response received:",{status:c.status,statusText:c.statusText,ok:c.ok,headers:{contentType:c.headers.get("content-type")}});const n=await c.text();console.log("📄 Raw response body:",n);let i;try{i=JSON.parse(n)}catch(u){console.error("❌ JSON parse error:",u),console.error("Raw response that failed to parse:",n),alert(`Server returned invalid JSON response. Check console for details.

Response preview: ${n.substring(0,200)}`);return}console.log("✅ Parsed response:",i),i.success?(console.log("✓ Delete successful, reloading tours..."),await m(),alert(`Tour "${s}" archived successfully! ${i.data||""}`)):(console.error("❌ Delete failed:",i.data),alert(`Failed to delete: ${i.data||"Unknown error"}

Check WordPress error logs for "H3TM S3 Archive:" messages.`))}catch(a){console.error("💥 Delete operation exception:",{error:a,errorMessage:a instanceof Error?a.message:String(a),errorStack:a instanceof Error?a.stack:void 0,tourName:s}),alert(`Failed to delete tour "${s}".

Error: ${a instanceof Error?a.message:String(a)}

Check browser console and WordPress error logs for more details.`)}break}};return P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-blue-500"})}):y.length===0?e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-gray-100 p-3",children:e.jsx(F,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No tours available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload your first tour to get started"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[y.length," ",y.length===1?"tour":"tours"," found"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(A,{onClick:()=>{m(),w==null||w()},variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Refresh"]})})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 overflow-hidden bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tour Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"URL"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:I===t.name?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{value:f,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"&&C(t.name),s.key==="Escape"&&j()},className:"h-8 text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>C(t.name),className:"p-1 hover:bg-green-50 rounded text-green-600",title:"Save",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("button",{onClick:j,className:"p-1 hover:bg-red-50 rounded text-red-600",title:"Cancel",children:e.jsx(J,{className:"h-4 w-4"})})]})]}):e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),t.status&&t.status!=="completed"&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.status==="processing"?"bg-yellow-100 text-yellow-800":t.status==="uploading"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.status})]}),t.tour_id&&e.jsxs("span",{className:"text-xs font-mono text-gray-500",title:"Tour ID (immutable identifier)",children:["ID: ",t.tour_id]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline truncate block max-w-md",children:t.url})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>h("view",t.name,t.url),className:"p-2 hover:bg-blue-50 rounded-md transition-colors group",title:"View Tour",children:e.jsx(F,{className:"h-4 w-4 text-gray-500 group-hover:text-blue-600"})}),e.jsx("button",{onClick:()=>h("changeUrl",t.name,t.url),className:"p-2 hover:bg-purple-50 rounded-md transition-colors group",title:"Change URL",children:e.jsx(X,{className:"h-4 w-4 text-gray-500 group-hover:text-purple-600"})}),e.jsx("button",{onClick:()=>h("rename",t.name),className:"p-2 hover:bg-amber-50 rounded-md transition-colors group",title:"Rename Tour",children:e.jsx(G,{className:"h-4 w-4 text-gray-500 group-hover:text-amber-600"})}),e.jsx("button",{onClick:()=>h("update",t.name),className:"p-2 hover:bg-green-50 rounded-md transition-colors group",title:"Update Tour",children:e.jsx(U,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("button",{onClick:()=>h("getScript",t.name),className:"p-2 hover:bg-indigo-50 rounded-md transition-colors group",title:"Get Script",children:e.jsx(W,{className:"h-4 w-4 text-gray-500 group-hover:text-indigo-600"})}),e.jsx("button",{onClick:()=>h("delete",t.name),className:"p-2 hover:bg-red-50 rounded-md transition-colors group",title:"Delete Tour",children:e.jsx(K,{className:"h-4 w-4 text-gray-500 group-hover:text-red-600"})})]})})]},t.name))})]})})})]})}console.log("Tours Table script loaded");const _=document.getElementById("h3tm-tours-table-root");console.log("Looking for tours table container:",_);_?(console.log("Mounting Tours Table component"),H(_).render(e.jsx(B.StrictMode,{children:e.jsx(Q,{onRefresh:()=>{console.log("Tours table refreshed")}})})),console.log("Tours Table mounted successfully")):console.error("Could not find h3tm-tours-table-root container!");
