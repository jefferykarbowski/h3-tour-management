import{g as M,r as i,j as e,u as oe,D as Y,b as Q,c as Z,d as ee,e as te,L as ie,m as R,F as le,U as X,P as ae,B as G,a as J,C as ne,I as de,f as ce,R as pe}from"./chunks/index-B1xDN1qa.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=M("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=M("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=M("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=M("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=M("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=M("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=M("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=M("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ye=({isOpen:g,onClose:j,tourName:L,tourUrl:S,embedScript:N,embedScriptResponsive:m})=>{const[_,w]=i.useState(!1),[k,D]=i.useState(!1);i.useEffect(()=>{const l=C=>{C.key==="Escape"&&g&&j()};return g&&document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[g,j]);const f=async(l,C)=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l);else{const v=document.createElement("textarea");v.value=l,v.style.position="fixed",v.style.opacity="0",document.body.appendChild(v),v.select(),document.execCommand("copy"),document.body.removeChild(v)}C==="standard"?(w(!0),setTimeout(()=>w(!1),2e3)):(D(!0),setTimeout(()=>D(!1),2e3))}catch{alert("Failed to copy to clipboard. Please select and copy manually.")}};return g?e.jsx("div",{className:`h3tm-modal-overlay h3tm-embed-modal ${g?"h3tm-modal-show":""}`,role:"dialog",onClick:l=>{l.target===l.currentTarget&&j()},children:e.jsxs("div",{className:"h3tm-modal-container h3tm-embed-container",children:[e.jsxs("div",{className:"h3tm-modal-header",children:[e.jsxs("h3",{children:["Embed Code for: ",L]}),e.jsx("button",{type:"button",className:"h3tm-modal-close",onClick:j,style:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#666",padding:"0",width:"30px",height:"30px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:l=>l.currentTarget.style.color="#000",onMouseLeave:l=>l.currentTarget.style.color="#666","aria-label":"Close modal",children:"Ã—"})]}),e.jsxs("div",{className:"h3tm-modal-body",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tour URL:"})," ",e.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",children:S})]}),e.jsxs("div",{className:"h3tm-embed-option",children:[e.jsx("h4",{children:"Standard Embed (Fixed Height)"}),e.jsx("textarea",{id:"h3tm-embed-standard",className:"h3tm-embed-code",value:N,readOnly:!0}),e.jsx("button",{type:"button",className:`button button-primary h3tm-copy-embed ${_?"h3tm-copy-success":""}`,onClick:()=>f(N,"standard"),children:_?"âœ“ Copied!":"Copy to Clipboard"})]}),e.jsxs("div",{className:"h3tm-embed-option",children:[e.jsx("h4",{children:"Responsive Embed (16:9 Aspect Ratio)"}),e.jsx("textarea",{id:"h3tm-embed-responsive",className:"h3tm-embed-code",value:m,readOnly:!0}),e.jsx("button",{type:"button",className:`button button-primary h3tm-copy-embed ${k?"h3tm-copy-success":""}`,onClick:()=>f(m,"responsive"),children:k?"âœ“ Copied!":"Copy to Clipboard"})]}),e.jsxs("div",{className:"h3tm-embed-instructions",children:[e.jsx("h4",{children:"How to Use:"}),e.jsxs("ol",{children:[e.jsx("li",{children:'Click "Copy to Clipboard" on your preferred embed option'}),e.jsx("li",{children:"Paste the code into your website HTML"}),e.jsx("li",{children:"The tour will display in an iframe"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," The responsive embed maintains a 16:9 aspect ratio and works well on all devices."]})]})]}),e.jsx("div",{className:"h3tm-modal-footer",children:e.jsx("button",{type:"button",className:"button button-secondary",onClick:j,style:{padding:"8px 16px",lineHeight:"1.5",minHeight:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"Close"})})]})}):null},je={initial:{x:0,y:0},animate:{x:20,y:-20,opacity:.9}},we={initial:{opacity:0},animate:{opacity:1}};function be(){return e.jsx("div",{className:"flex bg-gray-100 dark:bg-neutral-900 flex-shrink-0 flex-wrap justify-center items-center gap-x-px gap-y-px scale-105",children:Array.from({length:11}).map((L,S)=>Array.from({length:41}).map((N,m)=>{const _=S*41+m;return e.jsx("div",{className:`w-10 h-10 flex flex-shrink-0 rounded-[2px] ${_%2===0?"bg-gray-50 dark:bg-neutral-950":"bg-gray-50 dark:bg-neutral-950 shadow-[0px_0px_1px_3px_rgba(255,255,255,1)_inset] dark:shadow-[0px_0px_1px_3px_rgba(0,0,0,1)_inset]"}`},`${m}-${S}`)}))})}function ve({isOpen:g,onClose:j,tourId:L,tourName:S,onUpdateComplete:N}){const[m,_]=i.useState(null),[w,k]=i.useState(!1),[D,f]=i.useState(0),[l,C]=i.useState(!1),[v,q]=i.useState("uploading"),[B,z]=i.useState(""),[P,A]=i.useState(""),U=i.useRef(null),H=i.useRef(null);i.useEffect(()=>()=>{x()},[]);const $=r=>{if(r.length>0){const h=r[0];h.name.endsWith(".zip")&&_(h)}},V=()=>{var r;(r=U.current)==null||r.click()},{getRootProps:F,isDragActive:t}=oe({multiple:!1,noClick:!0,accept:{"application/zip":[".zip"]},onDrop:$}),s=async r=>{var u,d;const h=new FormData;h.append("action","h3tm_get_update_progress"),h.append("tour_id",r),h.append("nonce",((u=window.h3tm_ajax)==null?void 0:u.nonce)||"");try{const c=await(await fetch(((d=window.h3tm_ajax)==null?void 0:d.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:h})).json();if(c.success&&c.data){const a=c.data,n=a.progress||0;if(f(n),z(a.message||""),A(a.stage||""),a.status==="completed"||n>=100)x(),f(100),C(!0),setTimeout(()=>{k(!1),C(!1),_(null),f(0),z(""),A(""),j(),N==null||N()},1500);else if(a.status==="failed")throw x(),new Error(a.message||"Tour update failed")}}catch(o){console.error("Error polling progress:",o)}},b=r=>{x(),H.current=setInterval(()=>{s(r)},2e3),s(r)},x=()=>{H.current&&(clearInterval(H.current),H.current=null)},T=async()=>{var r,h,u;if(m){k(!0),f(0),q("uploading"),z(""),A("");try{const d=await I(m,L),o=d.s3_key;if(!o)throw new Error("Server did not return s3_key");await p(m,d),q("processing"),f(0),z("Initializing tour update...");const c=new FormData;c.append("action","h3tm_update_tour"),c.append("tour_id",L),c.append("s3_key",o),c.append("nonce",((r=window.h3tm_ajax)==null?void 0:r.nonce)||"");const n=await(await fetch(((h=window.h3tm_ajax)==null?void 0:h.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:c})).json();if(n.success&&((u=n.data)!=null&&u.async))b(L);else if(n.success)f(100),C(!0),setTimeout(()=>{k(!1),C(!1),_(null),f(0),j(),N==null||N()},1500);else throw new Error(n.data||"Unknown error")}catch(d){console.error("Error updating tour:",d),alert(`Failed to update tour: ${d instanceof Error?d.message:"Unknown error"}`),x(),k(!1),f(0),z(""),A("")}}},I=async(r,h)=>{var a,n,y;const u=new FormData;u.append("action","h3tm_get_s3_presigned_url"),u.append("tour_id",h),u.append("file_name",r.name),u.append("file_size",r.size.toString()),u.append("file_type",r.type||"application/zip"),u.append("is_update","true"),u.append("nonce",((a=window.h3tm_ajax)==null?void 0:a.nonce)||"");const d=await fetch(((n=window.h3tm_ajax)==null?void 0:n.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:u});if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);const o=await d.text();let c;try{c=JSON.parse(o)}catch{throw new Error(`Invalid JSON response: ${o.substring(0,200)}`)}if(!c.success)throw new Error(((y=c.data)==null?void 0:y.message)||c.data||"Failed to get upload URL");return c.data},p=async(r,h)=>new Promise((u,d)=>{const o=new XMLHttpRequest;o.upload.addEventListener("progress",a=>{if(a.lengthComputable){const n=Math.round(a.loaded/a.total*100);f(n)}}),o.addEventListener("load",()=>{o.status>=200&&o.status<300?u():d(new Error(`S3 upload failed: ${o.status} ${o.statusText}`))}),o.addEventListener("error",()=>{d(new Error("Network error during upload"))}),o.addEventListener("abort",()=>{d(new Error("Upload cancelled"))}),o.open("PUT",h.upload_url),o.timeout=3e5;const c=r.type||"application/zip";o.setRequestHeader("Content-Type",c),o.send(r)}),O=()=>{w||(_(null),f(0),j())};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{open:g&&!w,onOpenChange:O,children:e.jsxs(Q,{className:"sm:max-w-2xl",children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Update Tour: ",S]}),e.jsx(te,{children:"Upload a new version of this tour. The current version will be archived automatically."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"rounded-lg bg-amber-50 border border-amber-200 p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(me,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Important: This will archive and replace your current tour"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{className:"text-sm font-medium",children:"Tour File (.zip)"}),e.jsx("div",{className:"border-2 border-dashed rounded-lg bg-background hover:bg-accent/5 transition-colors",...F(),children:e.jsxs(R.div,{onClick:V,whileHover:"animate",className:"p-8 cursor-pointer w-full relative overflow-hidden",children:[e.jsx("input",{ref:U,id:"file-upload-handle",type:"file",accept:".zip",onChange:r=>$(Array.from(r.target.files||[])),className:"hidden"}),e.jsx("div",{className:"absolute inset-0 [mask-image:radial-gradient(ellipse_at_center,white,transparent)]",children:e.jsx(be,{})}),e.jsxs("div",{className:"flex flex-col items-center justify-center relative z-10",children:[e.jsx("div",{className:"relative w-full max-w-xl mx-auto",children:m?e.jsx(R.div,{layoutId:"file-upload",className:"relative overflow-hidden z-40 bg-card border border-border flex flex-col items-start justify-start p-4 w-full mx-auto rounded-md shadow-sm",children:e.jsxs("div",{className:"flex justify-between w-full items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-5 w-5 text-blue-500"}),e.jsx(R.p,{initial:{opacity:0},animate:{opacity:1},className:"text-sm font-medium text-foreground truncate max-w-xs",children:m.name})]}),e.jsxs(R.p,{initial:{opacity:0},animate:{opacity:1},className:"rounded-md px-2 py-1 text-xs bg-blue-500/10 text-blue-600 dark:text-blue-400",children:[(m.size/(1024*1024)).toFixed(2)," MB"]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(R.div,{layoutId:"file-upload",variants:je,transition:{type:"spring",stiffness:300,damping:20},className:"relative group-hover/file:shadow-lg z-40 bg-card border border-border flex items-center justify-center h-32 w-full max-w-[8rem] mx-auto rounded-md transition-shadow",children:t?e.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center text-blue-500",children:[e.jsx("span",{className:"text-xs mb-1",children:"Drop it"}),e.jsx(X,{className:"h-5 w-5"})]}):e.jsx(X,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx(R.div,{variants:we,className:"absolute opacity-0 border-2 border-dashed border-blue-400 inset-0 z-30 bg-transparent flex items-center justify-center h-32 w-full max-w-[8rem] mx-auto rounded-md"})]})}),!m&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Upload .zip file"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Drag and drop or click to browse"})]})]})]})})]}),w&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Upload Progress"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[D,"%"]})]}),e.jsx(ae,{value:D,className:"h-2"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{onClick:T,disabled:!m||w,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:w?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Update Tour"]})}),e.jsx(G,{onClick:O,disabled:w,variant:"outline",children:"Cancel"})]})]})]})}),e.jsx(Y,{open:w,onOpenChange:()=>{},children:e.jsxs(Q,{className:"sm:max-w-md",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:l?"Update Complete!":v==="uploading"?"Uploading to S3":"Processing Update"}),e.jsx(te,{children:l?"Your tour has been updated successfully.":v==="uploading"?"Uploading your updated tour file to AWS S3...":"Archiving current version and deploying updated tour..."})]}),e.jsx("div",{className:"space-y-4 py-4",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center py-6",children:[e.jsx(R.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15},children:e.jsx(ne,{className:"h-16 w-16 text-green-500"})}),e.jsx("p",{className:"mt-4 text-sm font-medium",children:S})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:v==="uploading"?"Upload Progress":"Processing Progress"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[D,"%"]})]}),e.jsx(ae,{value:D,className:"h-2"})]}),v==="uploading"?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(J,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsxs("span",{children:["Uploading ",m==null?void 0:m.name,"..."]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(J,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsx("span",{children:B||"Processing tour update..."})]}),P&&e.jsxs("div",{className:"pl-6 text-xs text-blue-600 font-medium",children:["Stage: ",P]}),e.jsxs("div",{className:"pl-6 space-y-1 text-xs text-muted-foreground",children:[e.jsx("div",{className:P==="downloading"?"text-blue-600 font-medium":"",children:"â€¢ Downloading from S3"}),e.jsx("div",{className:P==="extracting"?"text-blue-600 font-medium":"",children:"â€¢ Extracting tour files"}),e.jsx("div",{className:P==="uploading"?"text-blue-600 font-medium":"",children:"â€¢ Uploading to tours directory"}),e.jsx("div",{className:P==="invalidating"?"text-blue-600 font-medium":"",children:"â€¢ Invalidating CloudFront cache"}),e.jsx("div",{className:P==="cleanup"?"text-blue-600 font-medium":"",children:"â€¢ Cleaning up temporary files"})]})]})]})})]})})]})}function Ne({onRefresh:g}){const[j,L]=i.useState([]),[S,N]=i.useState(!0),[m,_]=i.useState(null),[w,k]=i.useState(""),[D,f]=i.useState(!1),[l,C]=i.useState({tourName:"",tourUrl:"",embedScript:"",embedScriptResponsive:""}),[v,q]=i.useState(!1),[B,z]=i.useState(""),[P,A]=i.useState("");i.useEffect(()=>{U()},[]);const U=async()=>{var t,s;N(!0);try{const b=new FormData;b.append("action","h3tm_list_s3_tours"),b.append("nonce",((t=window.h3tm_ajax)==null?void 0:t.nonce)||"");const T=await(await fetch(((s=window.h3tm_ajax)==null?void 0:s.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:b})).json();if(T.success&&T.data){const I=Array.isArray(T.data)?T.data:T.data.tours||[];L(I.map(p=>{const O=typeof p=="object"&&p.tour_slug?p.tour_slug:typeof p=="string"?p:p.name;return{name:typeof p=="string"?p:p.name,url:window.location.origin+"/h3panos/"+encodeURIComponent(O),status:typeof p=="string"?"completed":p.status,tour_id:typeof p=="string"?void 0:p.tour_id,updated_date:typeof p=="string"?void 0:p.updated_date}}))}}catch(b){console.error("Error loading tours:",b)}finally{N(!1)}},H=t=>{_(t),k(t)},$=()=>{_(null),k("")},V=async t=>{var s,b;if(w===t||!w.trim()){$();return}try{const x=new FormData;x.append("action","h3tm_rename_tour"),x.append("old_name",t),x.append("new_name",w),x.append("nonce",((s=window.h3tm_ajax)==null?void 0:s.nonce)||""),(await(await fetch(((b=window.h3tm_ajax)==null?void 0:b.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:x})).json()).success&&(await U(),$())}catch(x){console.error("Error renaming tour:",x)}},F=async(t,s,b,x)=>{var T,I,p,O,r,h,u,d,o;switch(t){case"view":window.open(b,"_blank");break;case"changeUrl":const c=prompt("Enter new URL slug (e.g., my-custom-tour-name):",b==null?void 0:b.split("/").pop());if(c&&c.trim())try{let a=c.trim();if(a.includes("/")&&(a=a.split("/").filter(W=>W).pop()||""),!a||a.length===0){alert("Invalid URL slug. Please enter a valid slug.");return}const n=new FormData;n.append("action","h3tm_change_tour_url"),n.append("tour_name",s),n.append("new_slug",a),n.append("nonce",((T=window.h3tm_ajax)==null?void 0:T.nonce)||"");const E=await(await fetch(((I=window.h3tm_ajax)==null?void 0:I.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:n})).json();E.success?(alert(`URL changed successfully for "${s}"
New URL: /h3panos/${a}`),await U()):alert(`Failed to change URL: ${E.data||"Unknown error"}`)}catch(a){console.error("Error changing URL:",a),alert("Failed to change URL. Check console for details.")}break;case"update":if(!x){alert("Cannot update legacy tour without tour_id. Please re-upload as a new tour.");return}z(x),A(s),q(!0);break;case"rename":H(s);break;case"getScript":try{const a=new FormData;a.append("action","h3tm_get_embed_script"),a.append("tour_name",s),a.append("nonce",((p=window.h3tm_ajax)==null?void 0:p.nonce)||"");const y=await(await fetch(((O=window.h3tm_ajax)==null?void 0:O.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:a})).json();y.success&&y.data?(C({tourName:y.data.tour_name,tourUrl:y.data.tour_url,embedScript:y.data.embed_script,embedScriptResponsive:y.data.embed_script_responsive}),f(!0)):alert(`Failed to get script: ${y.data||"Unknown error"}`)}catch(a){console.error("Error getting script:",a),alert("Failed to get embed script. Check console for details.")}break;case"delete":if(confirm(`Are you sure you want to archive "${s}"? The tour will be moved to the archive folder and permanently deleted after 90 days.`))try{console.log("ðŸ—‘ï¸ Delete Request Starting:",{tourName:s,ajaxUrl:(r=window.h3tm_ajax)==null?void 0:r.ajax_url,hasNonce:!!((h=window.h3tm_ajax)!=null&&h.nonce),timestamp:new Date().toISOString()});const a=new FormData;a.append("action","h3tm_delete_tour"),a.append("tour_name",s),a.append("nonce",((u=window.h3tm_ajax)==null?void 0:u.nonce)||""),console.log("ðŸ“¤ Sending DELETE request to:",((d=window.h3tm_ajax)==null?void 0:d.ajax_url)||"/wp-admin/admin-ajax.php");const n=await fetch(((o=window.h3tm_ajax)==null?void 0:o.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:a});console.log("ðŸ“¥ Response received:",{status:n.status,statusText:n.statusText,ok:n.ok,headers:{contentType:n.headers.get("content-type")}});const y=await n.text();console.log("ðŸ“„ Raw response body:",y);let E;try{E=JSON.parse(y)}catch(W){console.error("âŒ JSON parse error:",W),console.error("Raw response that failed to parse:",y),alert(`Server returned invalid JSON response. Check console for details.

Response preview: ${y.substring(0,200)}`);return}console.log("âœ… Parsed response:",E),E.success?(console.log("âœ“ Delete successful, reloading tours..."),await U(),alert(`Tour "${s}" archived successfully! ${E.data||""}`)):(console.error("âŒ Delete failed:",E.data),alert(`Failed to delete: ${E.data||"Unknown error"}

Check WordPress error logs for "H3TM S3 Archive:" messages.`))}catch(a){console.error("ðŸ’¥ Delete operation exception:",{error:a,errorMessage:a instanceof Error?a.message:String(a),errorStack:a instanceof Error?a.stack:void 0,tourName:s}),alert(`Failed to delete tour "${s}".

Error: ${a instanceof Error?a.message:String(a)}

Check browser console and WordPress error logs for more details.`)}break}};return S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(J,{className:"h-8 w-8 animate-spin text-blue-500"})}):j.length===0?e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-gray-100 p-3",children:e.jsx(se,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No tours available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload your first tour to get started"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{isOpen:D,onClose:()=>f(!1),tourName:l.tourName,tourUrl:l.tourUrl,embedScript:l.embedScript,embedScriptResponsive:l.embedScriptResponsive}),e.jsx(ve,{isOpen:v,onClose:()=>q(!1),tourId:B,tourName:P,onUpdateComplete:()=>{U(),g==null||g()}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[j.length," ",j.length===1?"tour":"tours"," found"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(G,{onClick:()=>{U(),g==null||g()},variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Refresh"]})})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 overflow-hidden bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tour Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"URL"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m===t.name?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{value:w,onChange:s=>k(s.target.value),onKeyDown:s=>{s.key==="Enter"&&V(t.name),s.key==="Escape"&&$()},className:"h-8 text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>V(t.name),className:"p-1 hover:bg-green-50 rounded text-green-600",title:"Save",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:$,className:"p-1 hover:bg-red-50 rounded text-red-600",title:"Cancel",children:e.jsx(ue,{className:"h-4 w-4"})})]})]}):e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),t.status&&t.status!=="completed"&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.status==="processing"?"bg-yellow-100 text-yellow-800":t.status==="uploading"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.status})]}),t.tour_id&&e.jsxs("span",{className:"text-xs font-mono text-gray-500",title:"Tour ID (immutable identifier)",children:["ID: ",t.tour_id]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline truncate block max-w-md",children:t.url})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-gray-500",children:t.updated_date?new Date(t.updated_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>F("view",t.name,t.url,t.tour_id),className:"p-2 hover:bg-blue-50 rounded-md transition-colors group",title:"View Tour",children:e.jsx(se,{className:"h-4 w-4 text-gray-500 group-hover:text-blue-600"})}),e.jsx("button",{onClick:()=>F("changeUrl",t.name,t.url,t.tour_id),className:"p-2 hover:bg-purple-50 rounded-md transition-colors group",title:"Change URL",children:e.jsx(he,{className:"h-4 w-4 text-gray-500 group-hover:text-purple-600"})}),e.jsx("button",{onClick:()=>F("rename",t.name,t.url,t.tour_id),className:"p-2 hover:bg-amber-50 rounded-md transition-colors group",title:"Rename Tour",children:e.jsx(ge,{className:"h-4 w-4 text-gray-500 group-hover:text-amber-600"})}),e.jsx("button",{onClick:()=>F("update",t.name,t.url,t.tour_id),className:"p-2 hover:bg-green-50 rounded-md transition-colors group",title:"Update Tour",disabled:!t.tour_id,children:e.jsx(re,{className:`h-4 w-4 ${t.tour_id?"text-gray-500 group-hover:text-green-600":"text-gray-300"}`})}),e.jsx("button",{onClick:()=>F("getScript",t.name,t.url,t.tour_id),className:"p-2 hover:bg-indigo-50 rounded-md transition-colors group",title:"Get Script",children:e.jsx(xe,{className:"h-4 w-4 text-gray-500 group-hover:text-indigo-600"})}),e.jsx("button",{onClick:()=>F("delete",t.name,t.url,t.tour_id),className:"p-2 hover:bg-red-50 rounded-md transition-colors group",title:"Delete Tour",children:e.jsx(fe,{className:"h-4 w-4 text-gray-500 group-hover:text-red-600"})})]})})]},t.tour_id||t.name))})]})})})]})]})}console.log("Tours Table script loaded");const K=document.getElementById("h3tm-tours-table-root");console.log("Looking for tours table container:",K);K?(console.log("Mounting Tours Table component"),ce(K).render(e.jsx(pe.StrictMode,{children:e.jsx(Ne,{onRefresh:()=>{console.log("Tours table refreshed")}})})),console.log("Tours Table mounted successfully")):console.error("Could not find h3tm-tours-table-root container!");
