import{c as y,r as h,j as e,L as V,B,I as J,C as W,h as X,R as G}from"./chunks/index-Gzz08Kjg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=y("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=y("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=y("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=y("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=y("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=y("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=y("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),te=({isOpen:m,onClose:p,tourName:R,tourUrl:_,embedScript:w,embedScriptResponsive:C})=>{const[f,g]=h.useState(!1),[b,T]=h.useState(!1);h.useEffect(()=>{const r=k=>{k.key==="Escape"&&m&&p()};return m&&document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[m,p]);const v=async(r,k)=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(r);else{const l=document.createElement("textarea");l.value=r,l.style.position="fixed",l.style.opacity="0",document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l)}k==="standard"?(g(!0),setTimeout(()=>g(!1),2e3)):(T(!0),setTimeout(()=>T(!1),2e3))}catch{alert("Failed to copy to clipboard. Please select and copy manually.")}};return m?e.jsx("div",{className:`h3tm-modal-overlay h3tm-embed-modal ${m?"h3tm-modal-show":""}`,role:"dialog",onClick:r=>{r.target===r.currentTarget&&p()},children:e.jsxs("div",{className:"h3tm-modal-container h3tm-embed-container",children:[e.jsxs("div",{className:"h3tm-modal-header",children:[e.jsxs("h3",{children:["Embed Code for: ",R]}),e.jsx("button",{type:"button",className:"h3tm-modal-close",onClick:p,style:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#666",padding:"0",width:"30px",height:"30px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:r=>r.currentTarget.style.color="#000",onMouseLeave:r=>r.currentTarget.style.color="#666","aria-label":"Close modal",children:"Ã—"})]}),e.jsxs("div",{className:"h3tm-modal-body",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tour URL:"})," ",e.jsx("a",{href:_,target:"_blank",rel:"noopener noreferrer",children:_})]}),e.jsxs("div",{className:"h3tm-embed-option",children:[e.jsx("h4",{children:"Standard Embed (Fixed Height)"}),e.jsx("textarea",{id:"h3tm-embed-standard",className:"h3tm-embed-code",value:w,readOnly:!0}),e.jsx("button",{type:"button",className:`button button-primary h3tm-copy-embed ${f?"h3tm-copy-success":""}`,onClick:()=>v(w,"standard"),children:f?"âœ“ Copied!":"Copy to Clipboard"})]}),e.jsxs("div",{className:"h3tm-embed-option",children:[e.jsx("h4",{children:"Responsive Embed (16:9 Aspect Ratio)"}),e.jsx("textarea",{id:"h3tm-embed-responsive",className:"h3tm-embed-code",value:C,readOnly:!0}),e.jsx("button",{type:"button",className:`button button-primary h3tm-copy-embed ${b?"h3tm-copy-success":""}`,onClick:()=>v(C,"responsive"),children:b?"âœ“ Copied!":"Copy to Clipboard"})]}),e.jsxs("div",{className:"h3tm-embed-instructions",children:[e.jsx("h4",{children:"How to Use:"}),e.jsxs("ol",{children:[e.jsx("li",{children:'Click "Copy to Clipboard" on your preferred embed option'}),e.jsx("li",{children:"Paste the code into your website HTML"}),e.jsx("li",{children:"The tour will display in an iframe"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," The responsive embed maintains a 16:9 aspect ratio and works well on all devices."]})]})]}),e.jsx("div",{className:"h3tm-modal-footer",children:e.jsx("button",{type:"button",className:"button button-secondary h3tm-modal-close",onClick:p,children:"Close"})})]})}):null};function ae({onRefresh:m}){const[p,R]=h.useState([]),[_,w]=h.useState(!0),[C,f]=h.useState(null),[g,b]=h.useState(""),[T,v]=h.useState(!1),[r,k]=h.useState({tourName:"",tourUrl:"",embedScript:"",embedScriptResponsive:""});h.useEffect(()=>{l()},[]);const l=async()=>{var a,s;w(!0);try{const c=new FormData;c.append("action","h3tm_list_s3_tours"),c.append("nonce",((a=window.h3tm_ajax)==null?void 0:a.nonce)||"");const u=await(await fetch(((s=window.h3tm_ajax)==null?void 0:s.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:c})).json();if(u.success&&u.data){const N=Array.isArray(u.data)?u.data:u.data.tours||[];R(N.map(n=>{const E=typeof n=="object"&&n.tour_slug?n.tour_slug:typeof n=="string"?n:n.name;return{name:typeof n=="string"?n:n.name,url:window.location.origin+"/h3panos/"+encodeURIComponent(E),status:typeof n=="string"?"completed":n.status,tour_id:typeof n=="string"?void 0:n.tour_id}}))}}catch(c){console.error("Error loading tours:",c)}finally{w(!1)}},q=a=>{f(a),b(a)},S=()=>{f(null),b("")},U=async a=>{var s,c;if(g===a||!g.trim()){S();return}try{const d=new FormData;d.append("action","h3tm_rename_tour"),d.append("old_name",a),d.append("new_name",g),d.append("nonce",((s=window.h3tm_ajax)==null?void 0:s.nonce)||""),(await(await fetch(((c=window.h3tm_ajax)==null?void 0:c.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:d})).json()).success&&(await l(),S())}catch(d){console.error("Error renaming tour:",d)}},j=async(a,s,c)=>{var d,u,N,n,E,$,F,P,I,O,z;switch(a){case"view":window.open(c,"_blank");break;case"changeUrl":const L=prompt("Enter new URL slug (e.g., my-custom-tour-name):",c==null?void 0:c.split("/").pop());if(L&&L.trim())try{let t=L.trim();if(t.includes("/")&&(t=t.split("/").filter(D=>D).pop()||""),!t||t.length===0){alert("Invalid URL slug. Please enter a valid slug.");return}const i=new FormData;i.append("action","h3tm_change_tour_url"),i.append("tour_name",s),i.append("new_slug",t),i.append("nonce",((d=window.h3tm_ajax)==null?void 0:d.nonce)||"");const x=await(await fetch(((u=window.h3tm_ajax)==null?void 0:u.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:i})).json();x.success?(alert(`URL changed successfully for "${s}"
New URL: /h3panos/${t}`),await l()):alert(`Failed to change URL: ${x.data||"Unknown error"}`)}catch(t){console.error("Error changing URL:",t),alert("Failed to change URL. Check console for details.")}break;case"update":if(confirm(`Re-upload and update "${s}"? This will replace the existing tour with a new version.`))try{const t=new FormData;t.append("action","h3tm_update_tour"),t.append("tour_name",s),t.append("nonce",((N=window.h3tm_ajax)==null?void 0:N.nonce)||"");const o=await(await fetch(((n=window.h3tm_ajax)==null?void 0:n.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:t})).json();o.success?(alert(`Update initiated for "${s}". ${o.data||""}`),await l()):alert(`Failed to update: ${o.data||"Unknown error"}`)}catch(t){console.error("Error updating tour:",t),alert("Failed to update tour. Check console for details.")}break;case"rename":q(s);break;case"getScript":try{const t=new FormData;t.append("action","h3tm_get_embed_script"),t.append("tour_name",s),t.append("nonce",((E=window.h3tm_ajax)==null?void 0:E.nonce)||"");const o=await(await fetch((($=window.h3tm_ajax)==null?void 0:$.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:t})).json();o.success&&o.data?(k({tourName:o.data.tour_name,tourUrl:o.data.tour_url,embedScript:o.data.embed_script,embedScriptResponsive:o.data.embed_script_responsive}),v(!0)):alert(`Failed to get script: ${o.data||"Unknown error"}`)}catch(t){console.error("Error getting script:",t),alert("Failed to get embed script. Check console for details.")}break;case"delete":if(confirm(`Are you sure you want to archive "${s}"? The tour will be moved to the archive folder and permanently deleted after 90 days.`))try{console.log("ðŸ—‘ï¸ Delete Request Starting:",{tourName:s,ajaxUrl:(F=window.h3tm_ajax)==null?void 0:F.ajax_url,hasNonce:!!((P=window.h3tm_ajax)!=null&&P.nonce),timestamp:new Date().toISOString()});const t=new FormData;t.append("action","h3tm_delete_tour"),t.append("tour_name",s),t.append("nonce",((I=window.h3tm_ajax)==null?void 0:I.nonce)||""),console.log("ðŸ“¤ Sending DELETE request to:",((O=window.h3tm_ajax)==null?void 0:O.ajax_url)||"/wp-admin/admin-ajax.php");const i=await fetch(((z=window.h3tm_ajax)==null?void 0:z.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:t});console.log("ðŸ“¥ Response received:",{status:i.status,statusText:i.statusText,ok:i.ok,headers:{contentType:i.headers.get("content-type")}});const o=await i.text();console.log("ðŸ“„ Raw response body:",o);let x;try{x=JSON.parse(o)}catch(D){console.error("âŒ JSON parse error:",D),console.error("Raw response that failed to parse:",o),alert(`Server returned invalid JSON response. Check console for details.

Response preview: ${o.substring(0,200)}`);return}console.log("âœ… Parsed response:",x),x.success?(console.log("âœ“ Delete successful, reloading tours..."),await l(),alert(`Tour "${s}" archived successfully! ${x.data||""}`)):(console.error("âŒ Delete failed:",x.data),alert(`Failed to delete: ${x.data||"Unknown error"}

Check WordPress error logs for "H3TM S3 Archive:" messages.`))}catch(t){console.error("ðŸ’¥ Delete operation exception:",{error:t,errorMessage:t instanceof Error?t.message:String(t),errorStack:t instanceof Error?t.stack:void 0,tourName:s}),alert(`Failed to delete tour "${s}".

Error: ${t instanceof Error?t.message:String(t)}

Check browser console and WordPress error logs for more details.`)}break}};return _?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(V,{className:"h-8 w-8 animate-spin text-blue-500"})}):p.length===0?e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-gray-100 p-3",children:e.jsx(A,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No tours available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload your first tour to get started"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(te,{isOpen:T,onClose:()=>v(!1),tourName:r.tourName,tourUrl:r.tourUrl,embedScript:r.embedScript,embedScriptResponsive:r.embedScriptResponsive}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[p.length," ",p.length===1?"tour":"tours"," found"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(B,{onClick:()=>{l(),m==null||m()},variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Refresh"]})})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 overflow-hidden bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tour Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"URL"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:C===a.name?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{value:g,onChange:s=>b(s.target.value),onKeyDown:s=>{s.key==="Enter"&&U(a.name),s.key==="Escape"&&S()},className:"h-8 text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>U(a.name),className:"p-1 hover:bg-green-50 rounded text-green-600",title:"Save",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("button",{onClick:S,className:"p-1 hover:bg-red-50 rounded text-red-600",title:"Cancel",children:e.jsx(K,{className:"h-4 w-4"})})]})]}):e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.name}),a.status&&a.status!=="completed"&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.status==="processing"?"bg-yellow-100 text-yellow-800":a.status==="uploading"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:a.status})]}),a.tour_id&&e.jsxs("span",{className:"text-xs font-mono text-gray-500",title:"Tour ID (immutable identifier)",children:["ID: ",a.tour_id]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline truncate block max-w-md",children:a.url})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>j("view",a.name,a.url),className:"p-2 hover:bg-blue-50 rounded-md transition-colors group",title:"View Tour",children:e.jsx(A,{className:"h-4 w-4 text-gray-500 group-hover:text-blue-600"})}),e.jsx("button",{onClick:()=>j("changeUrl",a.name,a.url),className:"p-2 hover:bg-purple-50 rounded-md transition-colors group",title:"Change URL",children:e.jsx(Y,{className:"h-4 w-4 text-gray-500 group-hover:text-purple-600"})}),e.jsx("button",{onClick:()=>j("rename",a.name),className:"p-2 hover:bg-amber-50 rounded-md transition-colors group",title:"Rename Tour",children:e.jsx(Z,{className:"h-4 w-4 text-gray-500 group-hover:text-amber-600"})}),e.jsx("button",{onClick:()=>j("update",a.name),className:"p-2 hover:bg-green-50 rounded-md transition-colors group",title:"Update Tour",children:e.jsx(H,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("button",{onClick:()=>j("getScript",a.name),className:"p-2 hover:bg-indigo-50 rounded-md transition-colors group",title:"Get Script",children:e.jsx(Q,{className:"h-4 w-4 text-gray-500 group-hover:text-indigo-600"})}),e.jsx("button",{onClick:()=>j("delete",a.name),className:"p-2 hover:bg-red-50 rounded-md transition-colors group",title:"Delete Tour",children:e.jsx(ee,{className:"h-4 w-4 text-gray-500 group-hover:text-red-600"})})]})})]},a.name))})]})})})]})]})}console.log("Tours Table script loaded");const M=document.getElementById("h3tm-tours-table-root");console.log("Looking for tours table container:",M);M?(console.log("Mounting Tours Table component"),X(M).render(e.jsx(G.StrictMode,{children:e.jsx(ae,{onRefresh:()=>{console.log("Tours table refreshed")}})})),console.log("Tours Table mounted successfully")):console.error("Could not find h3tm-tours-table-root container!");
