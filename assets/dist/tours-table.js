import{c,r as d,j as e,L as _,B as E,I as L,C as M,h as S,R}from"./chunks/index-Gzz08Kjg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=c("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=c("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=c("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=c("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=c("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=c("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=c("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function P({onRefresh:m}){const[h,k]=d.useState([]),[N,j]=d.useState(!0),[C,w]=d.useState(null),[p,g]=d.useState("");d.useEffect(()=>{x()},[]);const x=async()=>{var t,a;j(!0);try{const n=new FormData;n.append("action","h3tm_list_s3_tours"),n.append("nonce",((t=window.h3tm_ajax)==null?void 0:t.nonce)||"");const o=await(await fetch(((a=window.h3tm_ajax)==null?void 0:a.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:n})).json();if(o.success&&o.data){const i=Array.isArray(o.data)?o.data:o.data.tours||[];k(i.map(s=>({name:typeof s=="string"?s:s.name,url:window.location.origin+"/h3panos/"+encodeURIComponent(typeof s=="string"?s:s.name),status:typeof s=="string"?"completed":s.status})))}}catch(n){console.error("Error loading tours:",n)}finally{j(!1)}},T=t=>{w(t),g(t)},u=()=>{w(null),g("")},b=async t=>{var a,n;if(p===t||!p.trim()){u();return}try{const r=new FormData;r.append("action","h3tm_rename_tour"),r.append("old_name",t),r.append("new_name",p),r.append("nonce",((a=window.h3tm_ajax)==null?void 0:a.nonce)||""),(await(await fetch(((n=window.h3tm_ajax)==null?void 0:n.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:r})).json()).success&&(await x(),u())}catch(r){console.error("Error renaming tour:",r)}},l=async(t,a,n)=>{var r,o;switch(t){case"view":window.open(n,"_blank");break;case"changeUrl":const i=prompt("Enter new URL:",n);i&&console.log("Change URL for",a,"to",i);break;case"update":console.log("Update tour:",a);break;case"rename":T(a);break;case"getScript":console.log("Get script for:",a);break;case"delete":if(confirm(`Are you sure you want to archive "${a}"? The tour will be moved to the archive folder and permanently deleted after 90 days.`))try{const s=new FormData;s.append("action","h3tm_delete_tour"),s.append("tour_name",a),s.append("nonce",((r=window.h3tm_ajax)==null?void 0:r.nonce)||""),(await(await fetch(((o=window.h3tm_ajax)==null?void 0:o.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:s})).json()).success&&await x()}catch(s){console.error("Error deleting tour:",s)}break}};return N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-blue-500"})}):h.length===0?e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-gray-100 p-3",children:e.jsx(f,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No tours available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload your first tour to get started"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[h.length," ",h.length===1?"tour":"tours"," found"]}),e.jsxs(E,{onClick:()=>{x(),m==null||m()},variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"Refresh"]})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 overflow-hidden bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tour Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"URL"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:C===t.name?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{value:p,onChange:a=>g(a.target.value),onKeyDown:a=>{a.key==="Enter"&&b(t.name),a.key==="Escape"&&u()},className:"h-8 text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>b(t.name),className:"p-1 hover:bg-green-50 rounded text-green-600",title:"Save",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-red-50 rounded text-red-600",title:"Cancel",children:e.jsx(U,{className:"h-4 w-4"})})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),t.status&&t.status!=="completed"&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.status==="processing"?"bg-yellow-100 text-yellow-800":t.status==="uploading"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.status})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline truncate block max-w-md",children:t.url})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>l("view",t.name,t.url),className:"p-2 hover:bg-blue-50 rounded-md transition-colors group",title:"View Tour",children:e.jsx(f,{className:"h-4 w-4 text-gray-500 group-hover:text-blue-600"})}),e.jsx("button",{onClick:()=>l("changeUrl",t.name,t.url),className:"p-2 hover:bg-purple-50 rounded-md transition-colors group",title:"Change URL",children:e.jsx(z,{className:"h-4 w-4 text-gray-500 group-hover:text-purple-600"})}),e.jsx("button",{onClick:()=>l("update",t.name),className:"p-2 hover:bg-green-50 rounded-md transition-colors group",title:"Update Tour",children:e.jsx(v,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("button",{onClick:()=>l("rename",t.name),className:"p-2 hover:bg-amber-50 rounded-md transition-colors group",title:"Rename Tour",children:e.jsx(A,{className:"h-4 w-4 text-gray-500 group-hover:text-amber-600"})}),e.jsx("button",{onClick:()=>l("getScript",t.name),className:"p-2 hover:bg-indigo-50 rounded-md transition-colors group",title:"Get Script",children:e.jsx(D,{className:"h-4 w-4 text-gray-500 group-hover:text-indigo-600"})}),e.jsx("button",{onClick:()=>l("delete",t.name),className:"p-2 hover:bg-red-50 rounded-md transition-colors group",title:"Delete Tour",children:e.jsx(I,{className:"h-4 w-4 text-gray-500 group-hover:text-red-600"})})]})})]},t.name))})]})})})]})}console.log("Tours Table script loaded");const y=document.getElementById("h3tm-tours-table-root");console.log("Looking for tours table container:",y);y?(console.log("Mounting Tours Table component"),S(y).render(e.jsx(R.StrictMode,{children:e.jsx(P,{onRefresh:()=>{console.log("Tours table refreshed")}})})),console.log("Tours Table mounted successfully")):console.error("Could not find h3tm-tours-table-root container!");
