import{c as l,r as m,j as e,L as $,B as P,I as z,C as A,h as I,R as O}from"./chunks/index-Gzz08Kjg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=l("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=l("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=l("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=l("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=l("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=l("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=l("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function G({onRefresh:x}){const[u,F]=m.useState([]),[D,v]=m.useState(!0),[R,_]=m.useState(null),[g,y]=m.useState("");m.useEffect(()=>{d()},[]);const d=async()=>{var a,s;v(!0);try{const r=new FormData;r.append("action","h3tm_list_s3_tours"),r.append("nonce",((a=window.h3tm_ajax)==null?void 0:a.nonce)||"");const i=await(await fetch(((s=window.h3tm_ajax)==null?void 0:s.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:r})).json();if(i.success&&i.data){const h=Array.isArray(i.data)?i.data:i.data.tours||[];F(h.map(c=>({name:typeof c=="string"?c:c.name,url:window.location.origin+"/h3panos/"+encodeURIComponent(typeof c=="string"?c:c.name),status:typeof c=="string"?"completed":c.status})))}}catch(r){console.error("Error loading tours:",r)}finally{v(!1)}},M=a=>{_(a),y(a)},w=()=>{_(null),y("")},N=async a=>{var s,r;if(g===a||!g.trim()){w();return}try{const o=new FormData;o.append("action","h3tm_rename_tour"),o.append("old_name",a),o.append("new_name",g),o.append("nonce",((s=window.h3tm_ajax)==null?void 0:s.nonce)||""),(await(await fetch(((r=window.h3tm_ajax)==null?void 0:r.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:o})).json()).success&&(await d(),w())}catch(o){console.error("Error renaming tour:",o)}},p=async(a,s,r)=>{var o,i,h,c,C,T,E,L;switch(a){case"view":window.open(r,"_blank");break;case"changeUrl":const j=prompt("Enter new URL path (e.g., /custom-path/tour-name):",r);if(j&&j!==r)try{const t=new FormData;t.append("action","h3tm_change_tour_url"),t.append("tour_name",s),t.append("new_url",j),t.append("nonce",((o=window.h3tm_ajax)==null?void 0:o.nonce)||"");const n=await(await fetch(((i=window.h3tm_ajax)==null?void 0:i.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:t})).json();n.success?(alert(`URL changed successfully for "${s}"`),await d()):alert(`Failed to change URL: ${n.data||"Unknown error"}`)}catch(t){console.error("Error changing URL:",t),alert("Failed to change URL. Check console for details.")}break;case"update":if(confirm(`Re-upload and update "${s}"? This will replace the existing tour with a new version.`))try{const t=new FormData;t.append("action","h3tm_update_tour"),t.append("tour_name",s),t.append("nonce",((h=window.h3tm_ajax)==null?void 0:h.nonce)||"");const n=await(await fetch(((c=window.h3tm_ajax)==null?void 0:c.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:t})).json();n.success?(alert(`Update initiated for "${s}". ${n.data||""}`),await d()):alert(`Failed to update: ${n.data||"Unknown error"}`)}catch(t){console.error("Error updating tour:",t),alert("Failed to update tour. Check console for details.")}break;case"rename":M(s);break;case"getScript":try{const t=new FormData;t.append("action","h3tm_get_embed_script"),t.append("tour_name",s),t.append("nonce",((C=window.h3tm_ajax)==null?void 0:C.nonce)||"");const n=await(await fetch(((T=window.h3tm_ajax)==null?void 0:T.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:t})).json();if(n.success&&n.data){const b=n.data.script||n.data;navigator.clipboard?(await navigator.clipboard.writeText(b),alert(`Embed script copied to clipboard!

Script preview:
${b.substring(0,200)}...`)):prompt("Copy the embed script below:",b)}else alert(`Failed to get script: ${n.data||"Unknown error"}`)}catch(t){console.error("Error getting script:",t),alert("Failed to get embed script. Check console for details.")}break;case"delete":if(confirm(`Are you sure you want to archive "${s}"? The tour will be moved to the archive folder and permanently deleted after 90 days.`))try{const t=new FormData;t.append("action","h3tm_delete_tour"),t.append("tour_name",s),t.append("nonce",((E=window.h3tm_ajax)==null?void 0:E.nonce)||"");const n=await(await fetch(((L=window.h3tm_ajax)==null?void 0:L.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",body:t})).json();n.success?await d():alert(`Failed to delete: ${n.data||"Unknown error"}`)}catch(t){console.error("Error deleting tour:",t),alert("Failed to delete tour. Check console for details.")}break}};return D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"h-8 w-8 animate-spin text-blue-500"})}):u.length===0?e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-gray-100 p-3",children:e.jsx(S,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No tours available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload your first tour to get started"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[u.length," ",u.length===1?"tour":"tours"," found"]}),e.jsxs(P,{onClick:()=>{d(),x==null||x()},variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Refresh"]})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 overflow-hidden bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tour Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"URL"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R===a.name?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{value:g,onChange:s=>y(s.target.value),onKeyDown:s=>{s.key==="Enter"&&N(a.name),s.key==="Escape"&&w()},className:"h-8 text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>N(a.name),className:"p-1 hover:bg-green-50 rounded text-green-600",title:"Save",children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-red-50 rounded text-red-600",title:"Cancel",children:e.jsx(V,{className:"h-4 w-4"})})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.name}),a.status&&a.status!=="completed"&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.status==="processing"?"bg-yellow-100 text-yellow-800":a.status==="uploading"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:a.status})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline truncate block max-w-md",children:a.url})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>p("view",a.name,a.url),className:"p-2 hover:bg-blue-50 rounded-md transition-colors group",title:"View Tour",children:e.jsx(S,{className:"h-4 w-4 text-gray-500 group-hover:text-blue-600"})}),e.jsx("button",{onClick:()=>p("changeUrl",a.name,a.url),className:"p-2 hover:bg-purple-50 rounded-md transition-colors group",title:"Change URL",children:e.jsx(B,{className:"h-4 w-4 text-gray-500 group-hover:text-purple-600"})}),e.jsx("button",{onClick:()=>p("update",a.name),className:"p-2 hover:bg-green-50 rounded-md transition-colors group",title:"Update Tour",children:e.jsx(U,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("button",{onClick:()=>p("rename",a.name),className:"p-2 hover:bg-amber-50 rounded-md transition-colors group",title:"Rename Tour",children:e.jsx(H,{className:"h-4 w-4 text-gray-500 group-hover:text-amber-600"})}),e.jsx("button",{onClick:()=>p("getScript",a.name),className:"p-2 hover:bg-indigo-50 rounded-md transition-colors group",title:"Get Script",children:e.jsx(q,{className:"h-4 w-4 text-gray-500 group-hover:text-indigo-600"})}),e.jsx("button",{onClick:()=>p("delete",a.name),className:"p-2 hover:bg-red-50 rounded-md transition-colors group",title:"Delete Tour",children:e.jsx(X,{className:"h-4 w-4 text-gray-500 group-hover:text-red-600"})})]})})]},a.name))})]})})})]})}console.log("Tours Table script loaded");const k=document.getElementById("h3tm-tours-table-root");console.log("Looking for tours table container:",k);k?(console.log("Mounting Tours Table component"),I(k).render(e.jsx(O.StrictMode,{children:e.jsx(G,{onRefresh:()=>{console.log("Tours table refreshed")}})})),console.log("Tours Table mounted successfully")):console.error("Could not find h3tm-tours-table-root container!");
